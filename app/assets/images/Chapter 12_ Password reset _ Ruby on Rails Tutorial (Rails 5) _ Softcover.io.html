<!DOCTYPE html>
<!-- saved from url=(0049)https://www.railstutorial.org/book/password_reset -->
<html id="custDomain" class="fontawesome-i2svg-active fontawesome-i2svg-complete"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/1310fd97f1"></script><script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/nr-1099.min.js"></script><script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/6713.js" async="" type="text/javascript"></script><script type="text/javascript" async="" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/54eea5d20a23b37d87000040.js"></script><script id="facebook-jssdk" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/sdk.js"></script><script id="twitter-wjs" src="https://platform.twitter.com/widgets.js"></script><script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/120259081996654" async=""></script><script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/identity.js" async=""></script><script async="" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/fbevents.js"></script><script async="" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/analytics.js"></script><script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/1197428788.js" type="text/javascript"></script>

<meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="35zf80faLPY7fcG3i28YfQkqs029CN/WbS8DJOoQoYyhWQ3G28Vc5FDsvzAVwl2BXWDArcRmoF8LzveOBsOOKQ==">

<script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"1310fd97f1","applicationID":"71497409","transactionName":"IVZWR0tbWF4BFxhWVw1SSxxaQUdGCwhoRl0DXQ==","queueTime":6,"applicationTime":1880,"agent":""}</script>
<script>window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(3),u=e(4),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}catch(e){throw f.emit("fn-err",[arguments,this,e],t),e}finally{f.emit("fn-end",[c.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){if(!o)return!1;if(e!==o)return!1;if(!n)return!0;if(!i)return!1;for(var t=i.split("."),r=n.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var o=null,i=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var u=navigator.userAgent,f=u.match(a);f&&u.indexOf("Chrome")===-1&&u.indexOf("Chromium")===-1&&(o="Safari",i=f[1])}n.exports={agent:o,version:i,match:r}},{}],3:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],4:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],5:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=v(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){h[e]=v(e).concat(n)}function m(e,n){var t=h[e];if(t)for(var r=0;r<t.length;r++)t[r]===n&&t.splice(r,1)}function v(e){return h[e]||[]}function g(e){return p[e]=p[e]||o(t)}function w(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:n,buffer:w,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(3),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!E++){var e=x.info=NREUM.info,n=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+x.offset],null,"api");var t=l.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===l.readyState&&i()}function i(){f("mark",["domContent",a()+x.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-x.offset}var u=(new Date).getTime(),f=e("handle"),c=e(3),s=e("ee"),p=e(2),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1099.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),x=n.exports={offset:u,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};e(1),l[m]?(l[m]("DOMContentLoaded",i,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",o),d[v]("onload",r)),f("mark",["firstbyte",u],null,"api");var E=0,O=e(5)},{}]},{},["loader"]);</script>
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Chapter 12: Password reset | Ruby on Rails Tutorial (Rails 5) | Softcover.io</title>
<style type="text/css">svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1em}.svg-inline--fa.fa-stack-2x{height:2em;width:2em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}</style><link href="https://www.railstutorial.org/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed">
<link href="https://www.railstutorial.org/favicon.png" rel="icon">
<script defer="defer" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/all.js"></script>
<link href="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/css" rel="stylesheet" type="text/css">
<link rel="stylesheet" media="screen" href="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/reading-3b37fcf94507b3a156923707c49e7fc23b3282780410d210cc592d29e6ee2558.css">
<link href="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/print-f4bd271fd41b8086410e78c14546336605a29e5c72c2d08b094c7ccfe03de6c4.css" media="print" rel="stylesheet" type="text/css">
<script>
  window.Config = {
    env: "production",
    bucket: "softcover",
    previewBucket: "softcover-cloud"
  }
</script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/jquery-2.0.3.min.js" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/jquery.formalize.min.js" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/underscore-min.js" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/hammer.min.js" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/MathJax.js" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/saved_resource" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/jsapi" type="text/javascript"></script>
<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/application-2c2cf03cd43f8bd875bbfe9030d1fc2f44448e129149bf9d22e59692f2fe334b.js"></script>

<meta content="http://www.railstutorial.org" property="og:url">
<meta content="Ruby on Rails Tutorial (Rails 5)" property="og:title">
<meta content="Newly updated for Rails 5, the Ruby on Rails Tutorial book and screencast series teach you how to develop and deploy real, industrial-strength web applications with Ruby on Rails, the open-source web framework that powers top websites such as Twitter, Hulu, GitHub, and the Yellow Pages. The Ruby on Rails Tutorial book is available for free online and is available for purchase as an ebook (PDF, EPUB, and MOBI formats). The companion screencast series includes 14 individual lessons, one for each chapter of the Ruby on Rails Tutorial book." property="og:description">
<meta content="Softcover.io" property="og:site_name">
<meta content="https://softcover.s3.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/images/cover-web.png" property="og:image">
<meta content="https://softcover.s3.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/images/cover-web.png" property="og:image:secure_url">
<meta content="image/png" property="og:image:type">
<meta content="500" property="og:image:width">
<meta content="500" property="og:image:height">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('require', 'linker');
  ga('linker:autoLink', ['www.railstutorial.org', 'softcover.io']);

  ga('create', 'UA-46858978-1', 'softcover.io', {'allowLinker': true});
  ga('send', 'pageview');

  ga('create', 'UA-8667566-1', 'auto', {
    'name': 'book',
    'allowLinker': true
  });

  ga('book.send', 'pageview');

</script>

<!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '120259081996654', {
    em: '',
  });
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=120259081996654&ev=PageView&noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->


<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>


<script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/custom_domain_js.js" type="text/javascript"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style>
<style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#1d3c78;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}
.fb_customer_chat_bounce_in_v2{animation-duration:300ms;animation-name:fb_bounce_in_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_v2{animation-duration:300ms;animation-name:fb_bounce_out_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_v2_mobile_chat_started{animation-duration:300ms;animation-name:fb_bounce_in_v2_mobile_chat_started;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_v2_mobile_chat_started{animation-duration:300ms;animation-name:fb_bounce_out_v2_mobile_chat_started;transition-timing-function:ease-in}.fb_customer_chat_bubble_pop_in{animation-duration:250ms;animation-name:fb_customer_chat_bubble_bounce_in_animation}.fb_customer_chat_bubble_animated_no_badge{box-shadow:0 3px 12px rgba(0, 0, 0, .15);transition:box-shadow 150ms linear}.fb_customer_chat_bubble_animated_no_badge:hover{box-shadow:0 5px 24px rgba(0, 0, 0, .3)}.fb_customer_chat_bubble_animated_with_badge{box-shadow:-5px 4px 14px rgba(0, 0, 0, .15);transition:box-shadow 150ms linear}.fb_customer_chat_bubble_animated_with_badge:hover{box-shadow:-5px 8px 24px rgba(0, 0, 0, .2)}.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}.fb_mobile_overlay_active{background-color:#fff;height:100%;overflow:hidden;position:fixed;visibility:hidden;width:100%}@keyframes fb_bounce_in_v2{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}50%{transform:scale(1.03, 1.03);transform-origin:bottom right}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}}@keyframes fb_bounce_in_v2_mobile_chat_started{0%{opacity:0;top:20px}100%{opacity:1;top:0}}@keyframes fb_bounce_out_v2{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}}@keyframes fb_bounce_out_v2_mobile_chat_started{0%{opacity:1;top:0}100%{opacity:0;top:20px}}@keyframes fb_customer_chat_bubble_bounce_in_animation{0%{bottom:6pt;opacity:0;transform:scale(0, 0);transform-origin:center}70%{bottom:18pt;opacity:1;transform:scale(1.2, 1.2)}100%{transform:scale(1, 1)}}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/MathJax(1).js" id="mathJaxJS"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body class="reading side-menu-opened" style=""><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div><div id="MathJax_Message" style="display: none;"></div>
<noscript>
<div id='noscript'>
<h2>Please enable javascript</h2>
This site requires you to allow JavaScript to run in the browser for all features to work. Thank you!
</div>
</noscript>
<script type="text/javascript">
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
window.fbAsyncInit = function() {
FB.init({
appId      : '145973438749643',
xfbml      : true,
version    : 'v2.0'
});
};
(function(d, s, id){
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) {return;}
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/en_US/sdk.js";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>
<div class="container">
<div id="header">
<div class="wrapper">
<a class="logo" href="https://www.softcover.io/"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/logo-cb2b799a5b84e014246f782d1e9330447da7f588ec6ca125890c7cdcfcf9f460.png" alt="Logo cb2b799a5b84e014246f782d1e9330447da7f588ec6ca125890c7cdcfcf9f460">
</a><a id="mobileMenu" href="javascript://"><div class="closedMenu">

<span>Menu</span>
</div>
<div class="openMenu">
x
<span>Close</span>
</div>
</a><div class="j_userHeader closeLeft" style="display:inline"><ul class="headerMenu">
<li><a href="https://www.softcover.io/login">Log In</a></li>
<li><a href="https://www.softcover.io/account/sign_up">Sign Up</a></li>
</ul>
</div>
<div id="dropBG"></div>
<div class="clear"></div>
</div>
</div>

<div class="sc-content">
<link rel="stylesheet" media="screen" href="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/custom.css">
<div class="page-book">
<div class="bookHeader">
<div class="wrapper">
<div class="bookCover">
<a href="https://www.railstutorial.org/book"><img class="cover" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/cover-web.png" alt="Cover web">
<img class="coverBG" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/cover_bg-a267f19fd8b824c7c0873181647cc75bb6d54a494aa1942f1e24244792c9c684.png" alt="Cover bg a267f19fd8b824c7c0873181647cc75bb6d54a494aa1942f1e24244792c9c684">
</a></div>
<div class="bookInfo">
<h1>
Ruby on Rails Tutorial (Rails 5)
<span class="j_subtitle">Learn Web Development with Rails</span>
<strong class="book-author-name">Michael Hartl</strong>
</h1>
<p class="j_description">
 Newly updated for Rails 5, the Ruby on Rails Tutorial book and screencast series teach you how to develop and deploy real, industrial-strength web applications with Ruby on Rails, the open-source web framework that powers top websites such as Twitter, Hulu, GitHub, and the Yellow Pages. The Ruby on Rails Tutorial book is available for free online and is available for purchase as an ebook (PDF, EPUB, and MOBI formats). The companion screencast series includes 14 individual lessons, one for each chapter of the Ruby on Rails Tutorial book. 

</p>

<div class="bookControls">
<a href="https://www.railstutorial.org/"><button class="transBG">Book Info</button>
</a><a href="mailto:admin@railstutorial.org"><button class="transBG">Contact Author</button>
</a></div>

</div>

</div>
</div>

<div id="bookMenu" class="bookMenuFixed">
<div class="side-menu" id="book-side">
<div class="side-menu-toggle">
<a class="side-menu-close" onclick="$(&#39;.page-book&#39;).addClass(&#39;side-menu-closed&#39;)" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-12" aria-hidden="true" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M323.1 441l53.9-53.9c9.4-9.4 9.4-24.5 0-33.9L279.8 256l97.2-97.2c9.4-9.4 9.4-24.5 0-33.9L323.1 71c-9.4-9.4-24.5-9.4-33.9 0L192 168.2 94.8 71c-9.4-9.4-24.5-9.4-33.9 0L7 124.9c-9.4 9.4-9.4 24.5 0 33.9l97.2 97.2L7 353.2c-9.4 9.4-9.4 24.5 0 33.9L60.9 441c9.4 9.4 24.5 9.4 33.9 0l97.2-97.2 97.2 97.2c9.3 9.3 24.5 9.3 33.9 0z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a><a class="side-menu-open" onclick="$(&#39;.page-book&#39;).removeClass(&#39;side-menu-closed&#39;)" href="javascript://"><svg class="svg-inline--fa fa-bars fa-w-14" aria-hidden="true" data-prefix="fas" data-icon="bars" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg><!-- <i class="fas fa-bars"></i> -->
</a></div>
<div class="le-book-promo">
<img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/logo_shield_b-7be3bbe072c03d6cb05d124789361513ce241a2d1fc123249652abb6acb5b128.png" alt="Logo shield b 7be3bbe072c03d6cb05d124789361513ce241a2d1fc123249652abb6acb5b128">
<div class="le-book-note">
<div>New to software development?</div>
We want to teach you the single most valuable skill you can learn in the 21st century. Read the
<a href="http://www.learnenough.com/story">Learn Enough Story</a>
to find out more.
</div>
<header>
<a href="http://www.learnenough.com/story"><button>Start Learning Now</button>
</a></header>
</div>
<ul><li><a>Frontmatter</a></li><li><a>Chapter 1: From zero to deploy</a></li><li><a>Chapter 2: A toy app</a></li><li><a>Chapter 3: Mostly static pages</a></li><li><a>Chapter 4: Rails-flavored Ruby</a></li><li><a>Chapter 5: Filling in the layout</a></li><li><a>Chapter 6: Modeling users</a></li><li><a>Chapter 7: Sign up</a></li><li><a>Chapter 8: Basic login</a></li><li><a>Chapter 9: Advanced login</a></li><li><a>Chapter 10: Updating, showing, and deleting users</a></li><li><a>Chapter 11: Account activation</a></li><li><a>Chapter 12: Password reset</a></li><li><a>Chapter 13: User microposts</a></li><li><a>Chapter 14: Following users</a></li></ul>
</div>
<div class="bookMenu-actions j_downloadLinks"><a onclick="$(&#39;#bookMenuEmail&#39;).toggleClass(&#39;open&#39;); return false" class="buttonStyle greyButton iEmailUpdate" href="https://www.railstutorial.org/book/password_reset"><svg class="svg-inline--fa fa-heart fa-w-18" aria-hidden="true" data-prefix="fas" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M414.9 24C361.8 24 312 65.7 288 89.3 264 65.7 214.2 24 161.1 24 70.3 24 16 76.9 16 165.5c0 72.6 66.8 133.3 69.2 135.4l187 180.8c8.8 8.5 22.8 8.5 31.6 0l186.7-180.2c2.7-2.7 69.5-63.5 69.5-136C560 76.9 505.7 24 414.9 24z"></path></svg><!-- <i class="fas fa-heart"></i> -->
Mailing List
</a><a class="buttonStyle attention" href="https://www.railstutorial.org/#pricing">Buy Now</a>
</div>
<div class="bookMenuSearch">
<a id="j_singlePage" href="javascript://"><svg class="svg-inline--fa fa-search fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg><!-- <i class="fas fa-search"></i> -->
Single Page
</a></div>
<div class="bookMenu-arrows">
<a class="leftArrow" href="javascript://"></a>
<a class="upArrow" href="javascript://"></a>
<a class="rightArrow" href="javascript://"></a>
<div id="chapter-title">Chapter 12: Password reset</div>
</div>
<div id="bookMenuEmail">
<label>Get a free 8-part email course &amp; priority notifications about the Ruby on Rails Tutorial &amp; related products.</label>

<div class="j_followBookForm"><div id="j_bookFollowForm">
<form action="https://www.softcover.io/books/216/follow" accept-charset="UTF-8" data-remote="true" method="get"><input name="utf8" type="hidden" value="">
<!-- %input{name: "name", type: "text", placeholder: "YOUR NAME"} -->
<input name="email" placeholder="Your email address" type="text">
<input class="greyButton optClick_follow" data-disable-with="Submitting..." type="submit" value="Follow Author">
</form>

<p id="j_bookFollowNotice" style="display:none"></p>
</div>
</div>
</div>
</div>

<div class="book-wr">
<div id="bookHtml" style="opacity: 1;"><div id="book"><div id="_cha-password_reset" data-tralics-id="cid66" class="chapter" data-number="12" data-chapter="password_reset"><h1><a href="https://www.railstutorial.org/book/password_reset#cha-password_reset" class="heading hyperref"><span class="number">Chapter 12 </span>Password reset</a></h1>
<p>Having completed account activation (and thereby verified the users email address) in <a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>, were now in a good position to implement <em>password reset</em>, and thereby handle the common case of users forgetting their passwords.<sup id="_cha-12_footnote-ref-1" class="footnote"><a href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-1">1</a></sup><span class="intersentencespace"></span> As well see, many of the steps are similar to those for account activation, and we will have several opportunities to apply the lessons learned in <a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>.<span class="intersentencespace"></span> The beginning is different, though; unlike account activation, implementing password resets requires both a change to one of our views and two new forms (to handle email and new password submission).</p>
<p>Before writing any code, lets mock up the expected sequence for resetting passwords.<span class="intersentencespace"></span> Well start by adding a forgot password link to the sample applications login form (<a href="https://www.railstutorial.org/book/password_reset#fig-login_forgot_password_mockup" class="hyperref">Figure&nbsp;<span class="ref">12.1</span></a>).<span class="intersentencespace"></span> The forgot password link will go to a page with a form that takes in an email address and sends an email containing a password reset link (<a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_form_mockup" class="hyperref">Figure&nbsp;<span class="ref">12.2</span></a>).<span class="intersentencespace"></span> The reset link will go to a form for resetting the users password (with confirmation), as shown in <a href="https://www.railstutorial.org/book/password_reset#fig-reset_password_form_mockup" class="hyperref">Figure&nbsp;<span class="ref">12.3</span></a>.</p>
<div class="center figure" id="_fig-login_forgot_password_mockup" data-tralics-id="uid1465" data-number="12.1">
<div class="graphics image box"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/login_forgot_password_mockup.png" alt="images/figures/login_forgot_password_mockup"></div><div class="caption"><span class="header">Figure 12.1: </span><span class="description">A mockup of a forgot password link.
</span></div></div>
<div class="center figure" id="_fig-forgot_password_form_mockup" data-tralics-id="uid1466" data-number="12.2">
<div class="graphics image box"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/forgot_password_form_mockup.png" alt="images/figures/forgot_password_form_mockup"></div><div class="caption"><span class="header">Figure 12.2: </span><span class="description">A mockup of the forgot password form.
</span></div></div>
<div class="center figure" id="_fig-reset_password_form_mockup" data-tralics-id="uid1467" data-number="12.3">
<div class="graphics image box"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/reset_password_form_mockup.png" alt="images/figures/reset_password_form_mockup"></div><div class="caption"><span class="header">Figure 12.3: </span><span class="description">A mockup of the reset password form.
</span></div></div>
<p>If you followed <a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>, you already have a mailer for password resets, which was generated in <a href="https://www.railstutorial.org/book/account_activation#sec-account_activation_emails" class="hyperref">Section&nbsp;<span class="ref">11.2</span></a> (<a href="https://www.railstutorial.org/book/account_activation#code-generate_user_mailer" class="hyperref">Listing&nbsp;<span class="ref">11.6</span></a>).<span class="intersentencespace"></span> In this section, well complete the necessary preliminaries by adding a resource and data model for password resets (<a href="https://www.railstutorial.org/book/password_reset#sec-password_resets_resource" class="hyperref">Section&nbsp;<span class="ref">12.1</span></a>) to go along with the mailer.<span class="intersentencespace"></span> Well implement the actual password reset in <a href="https://www.railstutorial.org/book/password_reset#sec-resetting_the_password" class="hyperref">Section&nbsp;<span class="ref">12.3</span></a>.</p>
<p>In analogy with account activations, our general plan is to make a Password Resets resource, with each password reset consisting of a reset token and corresponding reset digest.<span class="intersentencespace"></span> The primary sequence goes like this:</p>
<ol>
<li>When a user requests a password reset, find the user by the submitted email address.<span class="intersentencespace"></span>
</li>
<li>If the email address exists in the database, generate a reset token and corresponding reset digest.<span class="intersentencespace"></span>
</li>
<li>Save the reset digest to the database, and then send an email to the user with a link containing the reset token and users email address.<span class="intersentencespace"></span>
</li>
<li>When the user clicks the link, find the user by email address, and then authenticate the token by comparing it to the reset digest.<span class="intersentencespace"></span>
</li>
<li>If authenticated, present the user with the form for changing the password.<span class="intersentencespace"></span>
</li></ol>
</div><div id="_sec-password_resets_resource" data-tralics-id="cid67" class="section" data-number="12.1"><h2><a href="https://www.railstutorial.org/book/password_reset#sec-password_resets_resource" class="heading hyperref"><span class="number">12.1 </span>Password resets resource</a></h2>
<p>As with sessions (<a href="https://www.railstutorial.org/book/basic_login#sec-sessions_and_failed_login" class="hyperref">Section&nbsp;<span class="ref">8.1</span></a>) and account activations (<a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>), well model password resets as a resource even though they wont be associated with an Active Record model.<span class="intersentencespace"></span> Instead, well include the relevant data (including the reset token) in the User model itself.</p>
<p>Because well be treating password resets as a resource, well interact with them via the standard REST URLs.<span class="intersentencespace"></span> Unlike the activation link, which required only an <code>edit</code> action, in this case well be rendering both <code>new</code> and <code>edit</code> forms for manipulating password resets, as well as creating and updating them, so well end up using four RESTful routes in total.</p>
<p>As usual, well make a topic branch for the new feature:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> git checkout -b password-reset
</pre></div></div>
<div id="_sec-password_resets_controller" data-tralics-id="uid1473" class="subsection" data-number="12.1.1"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-password_resets_controller" class="heading hyperref"><span class="number">12.1.1 </span>Password resets controller</a></h3>
<p>Our first step is to generate a controller for the Password Resets resource, in this case making both <code>new</code> and <code>edit</code> actions per the discussion above:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> rails generate controller PasswordResets new edit --no-test-framework
</pre></div></div>
<p>Note that weve included a flag to skip generating tests.<span class="intersentencespace"></span> This is because we dont need the controller tests, preferring instead to build on the integration test from <a href="https://www.railstutorial.org/book/account_activation#sec-activation_test_and_refactoring" class="hyperref">Section&nbsp;<span class="ref">11.3.3</span></a>.</p>
<p>Because well need forms both for creating new password resets (<a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_form_mockup" class="hyperref">Figure <span class="ref">12.2</span></a>) and for updating them by changing the password in the User model (<a href="https://www.railstutorial.org/book/password_reset#fig-reset_password_form_mockup" class="hyperref">Figure&nbsp;<span class="ref">12.3</span></a>), we need routes for <code>new</code>, <code>create</code>, <code>edit</code>, and <code>update</code>.<span class="intersentencespace"></span> We can arrange this with the <code>resources</code> line shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_resets_resource" class="hyperref">Listing&nbsp;<span class="ref">12.1</span></a>.</p>
<div class="codelisting" id="_code-password_resets_resource" data-tralics-id="uid1474" data-number="12.1"><div class="heading"><span class="number">Listing 12.1:</span> 

<span class="description">Adding a resource for password resets.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">config/routes.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span>   <span class="s1">'static_pages#home'</span>
  <span class="n">get</span>    <span class="s1">'/help'</span><span class="p">,</span>    <span class="ss">to</span><span class="p">:</span> <span class="s1">'static_pages#help'</span>
  <span class="n">get</span>    <span class="s1">'/about'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'static_pages#about'</span>
  <span class="n">get</span>    <span class="s1">'/contact'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'static_pages#contact'</span>
  <span class="n">get</span>    <span class="s1">'/signup'</span><span class="p">,</span>  <span class="ss">to</span><span class="p">:</span> <span class="s1">'users#new'</span>
  <span class="n">get</span>    <span class="s1">'/login'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'sessions#new'</span>
  <span class="n">post</span>   <span class="s1">'/login'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'sessions#create'</span>
  <span class="n">delete</span> <span class="s1">'/logout'</span><span class="p">,</span>  <span class="ss">to</span><span class="p">:</span> <span class="s1">'sessions#destroy'</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="n">resources</span> <span class="ss">:account_activations</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="o">]</span>
<span class="hll">  <span class="n">resources</span> <span class="ss">:password_resets</span><span class="p">,</span>     <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span><span class="k">end</span>
</pre></div></div></div><p>The code in <a href="https://www.railstutorial.org/book/password_reset#code-password_resets_resource" class="hyperref">Listing&nbsp;<span class="ref">12.1</span></a> arranges for the RESTful routes shown in <a href="https://www.railstutorial.org/book/password_reset#table-RESTful_password_resets" class="hyperref">Table&nbsp;<span class="ref">12.1</span></a>.<span class="intersentencespace"></span> In particular, the first route in <a href="https://www.railstutorial.org/book/password_reset#table-RESTful_password_resets" class="hyperref">Table&nbsp;<span class="ref">12.1</span></a> gives a link to the forgot password form via</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">new_password_reset_path</span>
</pre></div></div>
<p>as seen in <a href="https://www.railstutorial.org/book/password_reset#code-log_in_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.2</span></a> and <a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_link" class="hyperref">Figure&nbsp;<span class="ref">12.4</span></a>.</p>
<div class="table" id="_table-RESTful_password_resets" data-tralics-id="uid1475" data-number="12.1"><table class="tabular">
<tbody><tr class="bottom_border"><td class="align_left"><strong>HTTP request</strong></td>
<td class="align_left"><strong>URL</strong></td>
<td class="align_left"><strong>Action</strong></td>
<td class="align_left"><strong>Named route</strong></td>
</tr><tr><td class="align_left"><code class="tt">GET</code></td>
<td class="align_left">/password_resets/new</td>
<td class="align_left"><code>new</code></td>
<td class="align_left"><code>new_password_reset_path</code></td>
</tr><tr><td class="align_left"><code class="tt">POST</code></td>
<td class="align_left">/password_resets</td>
<td class="align_left"><code>create</code></td>
<td class="align_left"><code>password_resets_path</code></td>
</tr><tr><td class="align_left"><code class="tt">GET</code></td>
<td class="align_left">http://ex.co/password_resets/&lt;token&gt;/edit</td>
<td class="align_left"><code>edit</code></td>
<td class="align_left"><code>edit_password_reset_url(token)</code></td>
</tr><tr><td class="align_left"><code class="tt">PATCH</code></td>
<td class="align_left">/password_resets/&lt;token&gt;</td>
<td class="align_left"><code>update</code></td>
<td class="align_left"><code>password_reset_path(token)</code></td>
</tr></tbody></table><div class="caption"><span class="header">Table 12.1: </span><span class="description">RESTful routes provided by the Password Resets resource in <a href="https://www.railstutorial.org/book/password_reset#code-password_resets_resource" class="hyperref">Listing&nbsp;<span class="ref">12.1</span></a>.
</span></div></div>
<div class="codelisting" id="_code-log_in_password_reset" data-tralics-id="uid1476" data-number="12.2"><div class="heading"><span class="number">Listing 12.2:</span> 

<span class="description">Adding a link to password resets.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/sessions/new.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s2">"Log in"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Log in<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="p">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:session</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">login_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"(forgot password)"</span><span class="p">,</span> <span class="n">new_password_reset_path</span> <span class="cp">%&gt;</span>
</span>      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:remember_me</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"checkbox inline"</span> <span class="k">do</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">check_box</span> <span class="ss">:remember_me</span> <span class="cp">%&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Remember me on this computer<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>New user? <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Sign up now!"</span><span class="p">,</span> <span class="n">signup_path</span> <span class="cp">%&gt;</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div></div><div class="center figure" id="_fig-forgot_password_link" data-tralics-id="uid1477" data-number="12.4">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/forgot_password_link.png" alt="images/figures/forgot_password_link"></div><div class="caption"><span class="header">Figure 12.4: </span><span class="description">The login page with a forgot password link.
</span></div></div>
<div id="_sec-exercises_password_resets_controller" data-tralics-id="uid1478" class="subsubsection" data-number="12.1.1.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_resets_controller" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Verify that the test suite is still <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>. <span class="exercise" id="ex-4d9267"></span>
</li>
<li>Why does <a href="https://www.railstutorial.org/book/password_reset#table-RESTful_password_resets" class="hyperref">Table&nbsp;<span class="ref">12.1</span></a> list the <code>_url</code> form of the <code>edit</code> named route instead of the <code>_path</code> form?<span class="intersentencespace"></span> <em>Hint</em>: The answer is the same as for the similar account activations exercise (<a href="https://www.railstutorial.org/book/account_activation#sec-exercises_account_activations_controller" class="hyperref">Section&nbsp;<span class="ref">11.1.1.1</span></a>). <span class="exercise" id="ex-17b50e"></span>
</li></ol>
</div></div>
<div id="_sec-new_password_resets" data-tralics-id="uid1481" class="subsection" data-number="12.1.2"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-new_password_resets" class="heading hyperref"><span class="number">12.1.2 </span>New password resets</a></h3>
<p>To create new password resets, we first need to define the data model, which is similar to the one used for account activation (<a href="https://www.railstutorial.org/book/account_activation#fig-user_model_account_activation" class="hyperref">Figure&nbsp;<span class="ref">11.1</span></a>).<span class="intersentencespace"></span> Following the pattern set by remember tokens (<a href="https://www.railstutorial.org/book/advanced_login#cha-advanced_login" class="hyperref">Chapter&nbsp;<span class="ref">9</span></a>) and account activation tokens (<a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>), password resets will pair a virtual reset token for use in the reset email with a corresponding reset digest for retrieving the user.<span class="intersentencespace"></span> If we instead stored an unhashed token, an attacker with access to the database could send a reset request to the users email address and then use the token and email to visit the corresponding password reset link, thereby gaining control of the account.<span class="intersentencespace"></span> Using a digest for password resets is thus essential.<span class="intersentencespace"></span> As an additional security precaution, well also plan to <em>expire</em> the reset link after a couple of hours, which requires recording the time when the reset gets sent.<span class="intersentencespace"></span> The resulting <code>reset_digest</code> and <code>reset_sent_at</code> attributes appear in <a href="https://www.railstutorial.org/book/password_reset#fig-user_model_password_reset" class="hyperref">Figure&nbsp;<span class="ref">12.5</span></a>.</p>
<div class="center figure" id="_fig-user_model_password_reset" data-tralics-id="uid1482" data-number="12.5"><span class="graphics"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/user_model_password_reset.png" alt="user_model_password_reset"></span>
<div class="caption"><span class="header">Figure 12.5: </span><span class="description">The User model with added password reset attributes.
</span></div></div>
<p>The migration to add the attributes from <a href="https://www.railstutorial.org/book/password_reset#fig-user_model_password_reset" class="hyperref">Figure&nbsp;<span class="ref">12.5</span></a> appears as follows:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> rails generate migration add_reset_to_users reset_digest:string <span class="se">\</span>
&gt; reset_sent_at:datetime
</pre></div></div>
<p>(As before, the <code>&gt;</code> on the second line is a line continuation character inserted automatically by the shell, and should not be typed literally.)<span class="intersentencespace"></span> We then migrate as usual:</p>
<div class="code"><div class="highlight"><pre><span></span>$ rails db:migrate
</pre></div></div>
<p>To make the view for new password resets, well work in analogy with the previous form for making a new nonActive Record resource, namely, the login form (<a href="https://www.railstutorial.org/book/basic_login#code-login_form" class="hyperref">Listing&nbsp;<span class="ref">8.4</span></a>) for creating a new session, shown again in <a href="https://www.railstutorial.org/book/password_reset#code-login_form_redux" class="hyperref">Listing&nbsp;<span class="ref">12.3</span></a> for reference.</p>
<div class="codelisting" id="_code-login_form_redux" data-tralics-id="uid1483" data-number="12.3"><div class="heading"><span class="number">Listing 12.3:</span> 

<span class="description">Reviewing the code for the login form.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/sessions/new.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s2">"Log in"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Log in<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="p">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:session</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">login_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:remember_me</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"checkbox inline"</span> <span class="k">do</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">check_box</span> <span class="ss">:remember_me</span> <span class="cp">%&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Remember me on this computer<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>New user? <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Sign up now!"</span><span class="p">,</span> <span class="n">signup_path</span> <span class="cp">%&gt;</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div></div><p>The new password resets form has a lot in common with <a href="https://www.railstutorial.org/book/password_reset#code-login_form_redux" class="hyperref">Listing&nbsp;<span class="ref">12.3</span></a>; the most important differences are the use of a different resource and URL in the call to <code>form_for</code> and the omission of the password attribute.<span class="intersentencespace"></span> The result appears in <a href="https://www.railstutorial.org/book/password_reset#code-new_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.4</span></a> and <a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_form" class="hyperref">Figure&nbsp;<span class="ref">12.6</span></a>.</p>
<div class="codelisting" id="_code-new_password_reset" data-tralics-id="uid1484" data-number="12.4"><div class="heading"><span class="number">Listing 12.4:</span> 

<span class="description">A new password reset view.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/password_resets/new.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s2">"Forgot password"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Forgot password<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="p">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:password_reset</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">password_resets_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Submit"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div></div><div class="center figure" id="_fig-forgot_password_form" data-tralics-id="uid1485" data-number="12.6">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/forgot_password_form.png" alt="images/figures/forgot_password_form"></div><div class="caption"><span class="header">Figure 12.6: </span><span class="description">The forgot password form.
</span></div></div>
<div id="_sec-exercises_new_password_resets" data-tralics-id="uid1486" class="subsubsection" data-number="12.1.2.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_new_password_resets" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Why does the <code>form_for</code> in <a href="https://www.railstutorial.org/book/password_reset#code-new_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.4</span></a> use <code>:password_reset</code> instead of <code>@password_reset</code>? <span class="exercise" id="ex-3421f4"></span>
</li></ol>
</div></div>
<div id="_sec-password_reset_create_action" data-tralics-id="uid1488" class="subsection" data-number="12.1.3"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-password_reset_create_action" class="heading hyperref"><span class="number">12.1.3 </span>Password reset <code class="tt">create</code> action</a></h3>
<p>Upon submitting the form in <a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_form" class="hyperref">Figure&nbsp;<span class="ref">12.6</span></a>, we need to find the user by email address and update its attributes with the password reset token and sent-at timestamp.<span class="intersentencespace"></span> We then redirect to the root URL with an informative flash message.<span class="intersentencespace"></span> As with login (<a href="https://www.railstutorial.org/book/basic_login#code-correct_login_failure" class="hyperref">Listing&nbsp;<span class="ref">8.11</span></a>), in the case of an invalid submission we re-render the <code>new</code> page with a <code>flash.now</code> message.<sup id="_cha-12_footnote-ref-2" class="footnote"><a href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-2">2</a></sup><span class="intersentencespace"></span> The results appear in <a href="https://www.railstutorial.org/book/password_reset#code-create_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.5</span></a>.</p>
<div class="codelisting" id="_code-create_password_reset" data-tralics-id="uid1490" data-number="12.5"><div class="heading"><span class="number">Listing 12.5:</span> 

<span class="description">A <code>create</code> action for password resets.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/password_resets_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PasswordResetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password_reset</span><span class="o">][</span><span class="ss">:email</span><span class="o">].</span><span class="n">downcase</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@user</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">create_reset_digest</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">send_password_reset_email</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:info</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Email sent with password reset instructions"</span>
      <span class="n">redirect_to</span> <span class="n">root_url</span>
    <span class="k">else</span>
      <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">[</span><span class="ss">:danger</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Email address not found"</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>The code in the User model parallels the <code>create_activation_digest</code> method used in the <code>before_create</code> callback (<a href="https://www.railstutorial.org/book/account_activation#code-user_model_activation_code" class="hyperref">Listing&nbsp;<span class="ref">11.3</span></a>), as seen in <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.6</span></a>.</p>
<div class="codelisting" id="_code-user_model_password_reset" data-tralics-id="uid1491" data-number="12.6"><div class="heading"><span class="number">Listing 12.6:</span> 

<span class="description">Adding password reset methods to the User model.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/user.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="hll">  <span class="kp">attr_accessor</span> <span class="ss">:remember_token</span><span class="p">,</span> <span class="ss">:activation_token</span><span class="p">,</span> <span class="ss">:reset_token</span>
</span>  <span class="n">before_save</span>   <span class="ss">:downcase_email</span>
  <span class="n">before_create</span> <span class="ss">:create_activation_digest</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># Activates an account.</span>
  <span class="k">def</span> <span class="nf">activate</span>
    <span class="n">update_attribute</span><span class="p">(</span><span class="ss">:activated</span><span class="p">,</span>    <span class="kp">true</span><span class="p">)</span>
    <span class="n">update_attribute</span><span class="p">(</span><span class="ss">:activated_at</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Sends activation email.</span>
  <span class="k">def</span> <span class="nf">send_activation_email</span>
    <span class="no">UserMailer</span><span class="o">.</span><span class="n">account_activation</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
  <span class="k">end</span>

  <span class="c1"># Sets the password reset attributes.</span>
  <span class="k">def</span> <span class="nf">create_reset_digest</span>
<span class="hll">    <span class="nb">self</span><span class="o">.</span><span class="n">reset_token</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
</span><span class="hll">    <span class="n">update_attribute</span><span class="p">(</span><span class="ss">:reset_digest</span><span class="p">,</span>  <span class="no">User</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">reset_token</span><span class="p">))</span>
</span><span class="hll">    <span class="n">update_attribute</span><span class="p">(</span><span class="ss">:reset_sent_at</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span>  <span class="k">end</span>

  <span class="c1"># Sends password reset email.</span>
  <span class="k">def</span> <span class="nf">send_password_reset_email</span>
<span class="hll">    <span class="no">UserMailer</span><span class="o">.</span><span class="n">password_reset</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
</span>  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="c1"># Converts email to all lower-case.</span>
    <span class="k">def</span> <span class="nf">downcase_email</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span>
    <span class="k">end</span>

    <span class="c1"># Creates and assigns the activation token and digest.</span>
    <span class="k">def</span> <span class="nf">create_activation_digest</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">activation_token</span>  <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">activation_digest</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">activation_token</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>As shown in <a href="https://www.railstutorial.org/book/password_reset#fig-invalid_email_password_reset" class="hyperref">Figure&nbsp;<span class="ref">12.7</span></a>, at this point the applications behavior for invalid email addresses is already working.<span class="intersentencespace"></span> To get the application working upon submission of a valid email address as well, we need to define a password reset mailer method.</p>
<div class="center figure" id="_fig-invalid_email_password_reset" data-tralics-id="uid1492" data-number="12.7">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/invalid_email_password_reset.png" alt="images/figures/invalid_email_password_reset"></div><div class="caption"><span class="header">Figure 12.7: </span><span class="description">The forgot password form for an invalid email address.
</span></div></div>
<div id="_sec-exercises_password_reset_create_action" data-tralics-id="uid1493" class="subsubsection" data-number="12.1.3.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_create_action" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Submit a valid email address to the form shown in <a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_form" class="hyperref">Figure&nbsp;<span class="ref">12.6</span></a>.<span class="intersentencespace"></span> What error message do you get? <span class="exercise" id="ex-2f9a24"></span>
</li>
<li>Confirm at the console that the user in the previous exercise has valid <code>reset_digest</code> and <code>reset_sent_at</code> attributes, despite the error.<span class="intersentencespace"></span> What are the attribute values? <span class="exercise" id="ex-6eac27"></span>
</li></ol>
</div></div></div><div id="_sec-password_reset_emails" data-tralics-id="cid68" class="section" data-number="12.2"><h2><a href="https://www.railstutorial.org/book/password_reset#sec-password_reset_emails" class="heading hyperref"><span class="number">12.2 </span>Password reset emails</a></h2>
<p>We left <a href="https://www.railstutorial.org/book/password_reset#sec-password_resets_resource" class="hyperref">Section&nbsp;<span class="ref">12.1</span></a> with a nearly working <code>create</code> action in the Password Resets controller.<span class="intersentencespace"></span> The only thing missing is the method to deliver valid password reset emails.</p>
<p>If you followed <a href="https://www.railstutorial.org/book/account_activation#sec-account_activations_resource" class="hyperref">Section&nbsp;<span class="ref">11.1</span></a>, you already have a default <code>password_reset</code> method in <code>app/mailers/user_mailer.rb</code> as a result of the User mailer generation in <a href="https://www.railstutorial.org/book/account_activation#code-generate_user_mailer" class="hyperref">Listing&nbsp;<span class="ref">11.6</span></a>.<span class="intersentencespace"></span> If you skipped <a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>, you can just copy the code below (omitting the <code>account_activation</code> and related methods) and create the missing files as necessary.</p>
<div id="_sec-password_reset_mailer" data-tralics-id="uid1496" class="subsection" data-number="12.2.1"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-password_reset_mailer" class="heading hyperref"><span class="number">12.2.1 </span>Password reset mailer and templates</a></h3>
<p>In <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.6</span></a>, we applied the design pattern implemented as a refactoring in <a href="https://www.railstutorial.org/book/account_activation#sec-activation_test_and_refactoring" class="hyperref">Section&nbsp;<span class="ref">11.3.3</span></a> by putting the User mailer directly in the model (<a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.6</span></a>):</p>
<div class="code"><div class="highlight"><pre><span></span><span class="no">UserMailer</span><span class="o">.</span><span class="n">password_reset</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
</pre></div></div>
<p>The password reset mailer method needed to get this working is nearly identical to the mailer for account activation developed in <a href="https://www.railstutorial.org/book/account_activation#sec-account_activation_emails" class="hyperref">Section&nbsp;<span class="ref">11.2</span></a>.<span class="intersentencespace"></span> We first create a <code>password_reset</code> method in the user mailer (<a href="https://www.railstutorial.org/book/password_reset#code-mail_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.7</span></a>), and then define view templates for plain-text email (<a href="https://www.railstutorial.org/book/password_reset#code-password_reset_text" class="hyperref">Listing&nbsp;<span class="ref">12.8</span></a>) and HTML email (<a href="https://www.railstutorial.org/book/password_reset#code-password_reset_html" class="hyperref">Listing&nbsp;<span class="ref">12.9</span></a>).</p>
<div class="codelisting" id="_code-mail_password_reset" data-tralics-id="uid1497" data-number="12.7"><div class="heading"><span class="number">Listing 12.7:</span> 

<span class="description">Mailing the password reset link.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/mailers/user_mailer.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>

  <span class="k">def</span> <span class="nf">account_activation</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">mail</span> <span class="ss">to</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">subject</span><span class="p">:</span> <span class="s2">"Account activation"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">password_reset</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="hll">    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class="hll">    <span class="n">mail</span> <span class="ss">to</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">subject</span><span class="p">:</span> <span class="s2">"Password reset"</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><div class="codelisting" id="_code-password_reset_text" data-tralics-id="uid1498" data-number="12.8"><div class="heading"><span class="number">Listing 12.8:</span> 

<span class="description">The password reset plain-text email template.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/user_mailer/password_reset.text.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span>To reset your password click the link below:

<span class="cp">&lt;%=</span> <span class="n">edit_password_reset_url</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span> <span class="cp">%&gt;</span>

This link will expire in two hours.

If you did not request your password to be reset, please ignore this email and
your password will stay as it is.
</pre></div></div></div><div class="codelisting" id="_code-password_reset_html" data-tralics-id="uid1499" data-number="12.9"><div class="heading"><span class="number">Listing 12.9:</span> 

<span class="description">The password reset HTML email template.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/user_mailer/password_reset.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Password reset<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>To reset your password click the link below:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Reset password"</span><span class="p">,</span> <span class="n">edit_password_reset_url</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">,</span>
                                                      <span class="ss">email</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span> <span class="cp">%&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This link will expire in two hours.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
If you did not request your password to be reset, please ignore this email and
your password will stay as it is.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div></div></div><p>As with account activation emails (<a href="https://www.railstutorial.org/book/account_activation#sec-account_activation_emails" class="hyperref">Section&nbsp;<span class="ref">11.2</span></a>), we can preview password reset emails using the Rails email previewer.<span class="intersentencespace"></span> The code is exactly analogous to <a href="https://www.railstutorial.org/book/account_activation#code-account_activation_preview" class="hyperref">Listing&nbsp;<span class="ref">11.18</span></a>, as shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_preview" class="hyperref">Listing&nbsp;<span class="ref">12.10</span></a>.</p>
<div class="codelisting" id="_code-password_reset_preview" data-tralics-id="uid1500" data-number="12.10"><div class="heading"><span class="number">Listing 12.10:</span> 

<span class="description">A working preview method for password reset.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/mailers/previews/user_mailer_preview.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="c1"># Preview all emails at http://localhost:3000/rails/mailers/user_mailer</span>
<span class="k">class</span> <span class="nc">UserMailerPreview</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Preview</span>

  <span class="c1"># Preview this email at</span>
  <span class="c1"># http://localhost:3000/rails/mailers/user_mailer/account_activation</span>
  <span class="k">def</span> <span class="nf">account_activation</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
    <span class="n">user</span><span class="o">.</span><span class="n">activation_token</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
    <span class="no">UserMailer</span><span class="o">.</span><span class="n">account_activation</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Preview this email at</span>
  <span class="c1"># http://localhost:3000/rails/mailers/user_mailer/password_reset</span>
  <span class="k">def</span> <span class="nf">password_reset</span>
<span class="hll">    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
</span><span class="hll">    <span class="n">user</span><span class="o">.</span><span class="n">reset_token</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
</span><span class="hll">    <span class="no">UserMailer</span><span class="o">.</span><span class="n">password_reset</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>With the code in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_preview" class="hyperref">Listing&nbsp;<span class="ref">12.10</span></a>, the HTML and text email previews appear as in <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_html_preview" class="hyperref">Figure&nbsp;<span class="ref">12.8</span></a> and <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_text_preview" class="hyperref">Figure&nbsp;<span class="ref">12.9</span></a>.</p>
<div class="center figure" id="_fig-password_reset_html_preview" data-tralics-id="uid1501" data-number="12.8">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/password_reset_html_preview_4th_ed.png" alt="images/figures/password_reset_html_preview_4th_ed"></div><div class="caption"><span class="header">Figure 12.8: </span><span class="description">A preview of the HTML version of the password reset email.
</span></div></div>
<div class="center figure" id="_fig-password_reset_text_preview" data-tralics-id="uid1502" data-number="12.9">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/password_reset_text_preview_4th_ed.png" alt="images/figures/password_reset_text_preview_4th_ed"></div><div class="caption"><span class="header">Figure 12.9: </span><span class="description">A preview of the text version of the password reset email.
</span></div></div>
<p>With the code in <a href="https://www.railstutorial.org/book/password_reset#code-mail_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.7</span></a>, <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_text" class="hyperref">Listing&nbsp;<span class="ref">12.8</span></a>, and <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_html" class="hyperref">Listing&nbsp;<span class="ref">12.9</span></a>, submission of a valid email address appears as shown in <a href="https://www.railstutorial.org/book/password_reset#fig-valid_email_password_reset" class="hyperref">Figure&nbsp;<span class="ref">12.10</span></a>.<span class="intersentencespace"></span> The corresponding email appears in the server log and should look something like <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_email" class="hyperref">Listing&nbsp;<span class="ref">12.11</span></a>.</p>
<div class="center figure" id="_fig-valid_email_password_reset" data-tralics-id="uid1503" data-number="12.10">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/valid_email_password_reset.png" alt="images/figures/valid_email_password_reset"></div><div class="caption"><span class="header">Figure 12.10: </span><span class="description">The result of submitting a valid email address.
</span></div></div>
<div class="codelisting" id="_code-password_reset_email" data-tralics-id="uid1504" data-number="12.11"><div class="heading"><span class="number">Listing 12.11:</span> 

<span class="description">A sample password reset email from the server log.</span>
</div>

<div class="code"><div class="highlight"><pre><span></span>Sent mail to michael@michaelhartl.com (66.8ms)
Date: Mon, 06 Jun 2016 22:00:41 +0000
From: noreply@example.com
To: michael@michaelhartl.com
Message-ID: &lt;5407babbee139_8722b257d04576a@mhartl-rails-tutorial-953753.mail&gt;
Subject: Password reset
Mime-Version: 1.0
Content-Type: multipart/alternative;
 boundary="--==_mimepart_5407babbe3505_8722b257d045617";
 charset=UTF-8
Content-Transfer-Encoding: 7bit


----==_mimepart_5407babbe3505_8722b257d045617
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

To reset your password click the link below:

https://rails-tutorial-mhartl.c9users.io/password_resets/3BdBrXeQZSWqFIDRN8cxHA/
edit?email=michael%40michaelhartl.com

This link will expire in two hours.

If you did not request your password to be reset, please ignore this email and
your password will stay as it is.
----==_mimepart_5407babbe3505_8722b257d045617
Content-Type: text/html;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

&lt;h1&gt;Password reset&lt;/h1&gt;

&lt;p&gt;To reset your password click the link below:&lt;/p&gt;

&lt;a href="https://rails-tutorial-mhartl.c9users.io/
password_resets/3BdBrXeQZSWqFIDRN8cxHA/
edit?email=michael%40michaelhartl.com"&gt;Reset password&lt;/a&gt;

&lt;p&gt;This link will expire in two hours.&lt;/p&gt;

&lt;p&gt;
If you did not request your password to be reset, please ignore this email and
your password will stay as it is.
&lt;/p&gt;
----==_mimepart_5407babbe3505_8722b257d045617--
</pre></div></div></div>
<div id="_sec-exercises_password_reset_mailer" data-tralics-id="uid1505" class="subsubsection" data-number="12.2.1.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_mailer" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Preview the email templates in your browser.<span class="intersentencespace"></span> What do the Date fields read for your previews? <span class="exercise" id="ex-eafd2c"></span>
</li>
<li>Submit a valid email address to the new password reset form.<span class="intersentencespace"></span> What is the content of the generated email in the server log? <span class="exercise" id="ex-2da441"></span>
</li>
<li>At the console, find the user object corresponding to the email address from the previous exercise and verify that it has valid <code>reset_digest</code> and <code>reset_sent_at</code> attributes. <span class="exercise" id="ex-e45e7a"></span>
</li></ol>
</div></div>
<div id="_sec-reset_email_tests" data-tralics-id="uid1509" class="subsection" data-number="12.2.2"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-reset_email_tests" class="heading hyperref"><span class="number">12.2.2 </span>Email tests</a></h3>
<p>In analogy with the account activation mailer method test (<a href="https://www.railstutorial.org/book/account_activation#code-real_account_activation_test" class="hyperref">Listing&nbsp;<span class="ref">11.20</span></a>), well write a test of the password reset mailer method, as shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_mailer_test" class="hyperref">Listing&nbsp;<span class="ref">12.12</span></a>.</p>
<div class="codelisting" id="_code-password_reset_mailer_test" data-tralics-id="uid1510" data-number="12.12"><div class="heading"><span class="number">Listing 12.12:</span> 

<span class="description">Adding a test of the password reset mailer method.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/mailers/user_mailer_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserMailerTest</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="nb">test</span> <span class="s2">"account_activation"</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
    <span class="n">user</span><span class="o">.</span><span class="n">activation_token</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
    <span class="n">mail</span> <span class="o">=</span> <span class="no">UserMailer</span><span class="o">.</span><span class="n">account_activation</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">assert_equal</span> <span class="s2">"Account activation"</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">subject</span>
    <span class="n">assert_equal</span> <span class="o">[</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">]</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">to</span>
    <span class="n">assert_equal</span> <span class="o">[</span><span class="s2">"noreply@example.com"</span><span class="o">]</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">from</span>
    <span class="n">assert_match</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>               <span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">encoded</span>
    <span class="n">assert_match</span> <span class="n">user</span><span class="o">.</span><span class="n">activation_token</span><span class="p">,</span>   <span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">encoded</span>
    <span class="n">assert_match</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">),</span>  <span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">encoded</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"password_reset"</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
<span class="hll">    <span class="n">user</span><span class="o">.</span><span class="n">reset_token</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
</span>    <span class="n">mail</span> <span class="o">=</span> <span class="no">UserMailer</span><span class="o">.</span><span class="n">password_reset</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">assert_equal</span> <span class="s2">"Password reset"</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">subject</span>
    <span class="n">assert_equal</span> <span class="o">[</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">]</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">to</span>
    <span class="n">assert_equal</span> <span class="o">[</span><span class="s2">"noreply@example.com"</span><span class="o">]</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">from</span>
    <span class="n">assert_match</span> <span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">,</span>        <span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">encoded</span>
    <span class="n">assert_match</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">),</span>  <span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">encoded</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>At this point, the test suite should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="_uid1511" data-tralics-id="uid1511" data-number="12.13"><div class="heading"><span class="number">Listing 12.13:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre><span></span>$ rails test
</pre></div></div></div>
<div id="_sec-exercises_reset_email_tests" data-tralics-id="uid1512" class="subsubsection" data-number="12.2.2.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_reset_email_tests" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Run just the mailer tests.<span class="intersentencespace"></span> Are they <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>? <span class="exercise" id="ex-902b57"></span>
</li>
<li>Confirm that the test goes <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span> if you remove the second call to <code>CGI.escape</code> in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_mailer_test" class="hyperref">Listing&nbsp;<span class="ref">12.12</span></a>. <span class="exercise" id="ex-ff6506"></span>
</li></ol>
</div></div></div><div id="_sec-resetting_the_password" data-tralics-id="cid69" class="section" data-number="12.3"><h2><a href="https://www.railstutorial.org/book/password_reset#sec-resetting_the_password" class="heading hyperref"><span class="number">12.3 </span>Resetting the password</a></h2>
<p>Now that we have a correctly generated email as in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_email" class="hyperref">Listing&nbsp;<span class="ref">12.11</span></a>, we need to write the <code>edit</code> action in the Password Resets controller that actually resets the users password.<span class="intersentencespace"></span> As in <a href="https://www.railstutorial.org/book/account_activation#sec-activation_test_and_refactoring" class="hyperref">Section&nbsp;<span class="ref">11.3.3</span></a>, well write a thorough integration test as well.</p>
<div id="_sec-reset_edit_action" data-tralics-id="uid1515" class="subsection" data-number="12.3.1"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-reset_edit_action" class="heading hyperref"><span class="number">12.3.1 </span>Reset <code class="tt">edit</code> action</a></h3>
<p>Password reset emails such as that shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_email" class="hyperref">Listing&nbsp;<span class="ref">12.11</span></a> contain links of the following form:</p>
<div class="code"><div class="highlight"><pre><span></span>https://example.com/password_resets/3BdBrXeQZSWqFIDRN8cxHA/edit?email=fu%40bar.com
</pre></div></div>
<p>To get these links to work, we need a form for resetting passwords.<span class="intersentencespace"></span> The task is similar to updating users via the user edit view (<a href="https://www.railstutorial.org/book/updating_and_deleting_users#code-user_edit_view" class="hyperref">Listing&nbsp;<span class="ref">10.2</span></a>), but in this case with only password and confirmation fields.</p>
<p>Theres an additional complication, though: we expect to find the user by email address, which means we need its value in both the <code>edit</code> and <code>update</code> actions.<span class="intersentencespace"></span> The email will automatically be available in the <code>edit</code> action because of its presence in the link above, but after we submit the form its value will be lost.<span class="intersentencespace"></span> The solution is to use a <em>hidden field</em> to place (but not display) the email on the page, and then submit it along with the rest of the forms information.<span class="intersentencespace"></span> The result appears in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_form" class="hyperref">Listing&nbsp;<span class="ref">12.14</span></a>.</p>
<div class="codelisting" id="_code-password_reset_form" data-tralics-id="uid1516" data-number="12.14"><div class="heading"><span class="number">Listing 12.14:</span> 

<span class="description">The form to reset a password.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/password_resets/edit.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Reset password'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Reset password<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="p">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">password_reset_path</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span> <span class="cp">%&gt;</span>

<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">hidden_field_tag</span> <span class="ss">:email</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span>
</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">"Confirmation"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Update password"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div></div><p>Note that <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_form" class="hyperref">Listing&nbsp;<span class="ref">12.14</span></a> uses the form tag helper</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">hidden_field_tag</span> <span class="ss">:email</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span>
</pre></div></div>
<p>instead of</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">hidden_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span>
</pre></div></div>
<p>because the reset link puts the email in <code>params[:email]</code>, whereas the latter would put it in <code>params[:user][:email]</code>.</p>
<p>To get the form to render, we need to define an <code>@user</code> variable in the Password Resets controllers <code>edit</code> action.<span class="intersentencespace"></span> As with account activation (<a href="https://www.railstutorial.org/book/account_activation#code-account_activation_edit_action" class="hyperref">Listing&nbsp;<span class="ref">11.31</span></a>), this involves finding the user corresponding to the email address in <code>params[:email]</code>.<span class="intersentencespace"></span> We then need to verify that the user is valid, i.e., that it exists, is activated, and is authenticated according to the reset token from <code>params[:id]</code> (using the generalized <code>authenticated?</code> method defined in <a href="https://www.railstutorial.org/book/account_activation#code-generalized_authenticated_p" class="hyperref">Listing&nbsp;<span class="ref">11.26</span></a>).<span class="intersentencespace"></span> Because the existence of a valid <code>@user</code> is needed in both the <code>edit</code> and <code>update</code> actions, well put the code to find and validate it in a couple of before filters, as shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_edit_action" class="hyperref">Listing&nbsp;<span class="ref">12.15</span></a>.</p>
<div class="codelisting" id="_code-password_reset_edit_action" data-tralics-id="uid1517" data-number="12.15"><div class="heading"><span class="number">Listing 12.15:</span> 

<span class="description">The <code>edit</code> action for password reset.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/password_resets_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PasswordResetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="hll">  <span class="n">before_action</span> <span class="ss">:get_user</span><span class="p">,</span>   <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span><span class="hll">  <span class="n">before_action</span> <span class="ss">:valid_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span>  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">edit</span>
  <span class="k">end</span>

<span class="hll">  <span class="kp">private</span>
</span>
    <span class="k">def</span> <span class="nf">get_user</span>
<span class="hll">      <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="c1"># Confirms a valid user.</span>
    <span class="k">def</span> <span class="nf">valid_user</span>
<span class="hll">      <span class="k">unless</span> <span class="p">(</span><span class="vi">@user</span> <span class="o">&amp;&amp;</span> <span class="vi">@user</span><span class="o">.</span><span class="n">activated?</span> <span class="o">&amp;&amp;</span>
</span><span class="hll">              <span class="vi">@user</span><span class="o">.</span><span class="n">authenticated?</span><span class="p">(</span><span class="ss">:reset</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">))</span>
</span><span class="hll">        <span class="n">redirect_to</span> <span class="n">root_url</span>
</span><span class="hll">      <span class="k">end</span>
</span>    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>In <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_edit_action" class="hyperref">Listing&nbsp;<span class="ref">12.15</span></a>, compare the use of</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">authenticated?</span><span class="p">(</span><span class="ss">:reset</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</pre></div></div>
<p>to</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">authenticated?</span><span class="p">(</span><span class="ss">:remember</span><span class="p">,</span> <span class="n">cookies</span><span class="o">[</span><span class="ss">:remember_token</span><span class="o">]</span><span class="p">)</span>
</pre></div></div>
<p>in <a href="https://www.railstutorial.org/book/account_activation#code-generalized_current_user" class="hyperref">Listing&nbsp;<span class="ref">11.28</span></a> and</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">authenticated?</span><span class="p">(</span><span class="ss">:activation</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</pre></div></div>
<p>in <a href="https://www.railstutorial.org/book/account_activation#code-account_activation_edit_action" class="hyperref">Listing&nbsp;<span class="ref">11.31</span></a>.<span class="intersentencespace"></span> Together, these three uses complete the authentication methods shown in <a href="https://www.railstutorial.org/book/account_activation#table-password_token_digest" class="hyperref">Table&nbsp;<span class="ref">11.1</span></a>.</p>
<p>With the code as above, following the link from <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_email" class="hyperref">Listing&nbsp;<span class="ref">12.11</span></a> should render a password reset form.<span class="intersentencespace"></span> The result appears in <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_form" class="hyperref">Figure&nbsp;<span class="ref">12.11</span></a>.</p>
<div class="center figure" id="_fig-password_reset_form" data-tralics-id="uid1518" data-number="12.11">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/password_reset_form.png" alt="images/figures/password_reset_form"></div><div class="caption"><span class="header">Figure 12.11: </span><span class="description">The password reset form.
</span></div></div>
<div id="_sec-exercises_reset_edit_action" data-tralics-id="uid1519" class="subsubsection" data-number="12.3.1.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_reset_edit_action" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Follow the link in the email from the server log in <a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_mailer" class="hyperref">Section&nbsp;<span class="ref">12.2.1.1</span></a>.<span class="intersentencespace"></span> Does it properly render the form as shown in <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_form" class="hyperref">Figure&nbsp;<span class="ref">12.11</span></a>? <span class="exercise" id="ex-d39746"></span>
</li>
<li>What happens if you submit the form from the previous exercise? <span class="exercise" id="ex-fdabd9"></span>
</li></ol>
</div></div>
<div id="_sec-updating_the_reset" data-tralics-id="uid1522" class="subsection" data-number="12.3.2"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-updating_the_reset" class="heading hyperref"><span class="number">12.3.2 </span>Updating the reset</a></h3>
<p>Unlike the Account Activations <code>edit</code> method, which simply toggles the user from inactive to active, the <code>edit</code> method for Password Resets is a form, which must therefore submit to a corresponding <code>update</code> action.<span class="intersentencespace"></span> To define this <code>update</code> action, we need to consider four cases:</p>
<ol>
<li>An expired password reset
</li>
<li>A failed update due to an invalid password
</li>
<li>A failed update (which initially looks successful) due to an empty password and confirmation
</li>
<li>A successful update
</li></ol>
<p>Cases (1), (2), and (4) are fairly straightforward, but Case (3) is non-obvious and is explained in more detail below.</p>
<p>Case&nbsp;(1) applies to both the <code>edit</code> and <code>update</code> actions, and so logically belongs in a before filter:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">before_action</span> <span class="ss">:check_expiration</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>    <span class="c1"># Case (1)</span>
</pre></div></div>
<p>This requires defining a private <code>check_expiration</code> method:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="c1"># Checks expiration of reset token.</span>
<span class="k">def</span> <span class="nf">check_expiration</span>
  <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_reset_expired?</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:danger</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Password reset has expired."</span>
    <span class="n">redirect_to</span> <span class="n">new_password_reset_url</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
<p>In the <code>check_expiration</code> method, weve deferred the expiration check to the instance method <code>password_reset_expired?</code>, which is a little tricky and will be defined in a moment.</p>
<p><a href="https://www.railstutorial.org/book/password_reset#code-password_reset_update_action" class="hyperref">Listing&nbsp;<span class="ref">12.16</span></a> shows the implementation of these filters, together with the <code>update</code> action that implements Cases (2)(4).<span class="intersentencespace"></span> Case&nbsp;(2) gets handled by a failed update, with the error messages from the shared partial in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_form" class="hyperref">Listing&nbsp;<span class="ref">12.14</span></a> displaying automatically when the <code>edit</code> form is re-rendered.<span class="intersentencespace"></span> Case&nbsp;(4) corresponds to a successful change, and the result is similar to a successful login (<a href="https://www.railstutorial.org/book/basic_login#code-login_upon_signup" class="hyperref">Listing&nbsp;<span class="ref">8.25</span></a>).</p>
<p>The only failure case not handled by Case (2) is when the password is empty, which is currently allowed by our User model (<a href="https://www.railstutorial.org/book/updating_and_deleting_users#code-allow_blank_password" class="hyperref">Listing&nbsp;<span class="ref">10.13</span></a>) and so needs to be caught and handled explicitly.<sup id="_cha-12_footnote-ref-3" class="footnote"><a href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-3">3</a></sup><span class="intersentencespace"></span> This is Case&nbsp;(3) above.<span class="intersentencespace"></span> Our method in this case is to add an error directly to the <code>@user</code> objects error messages using <code>errors.add</code>:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:password</span><span class="p">,</span> <span class="ss">:blank</span><span class="p">)</span>
</pre></div></div>
<p>This arranges to use the default message for blank content when the password is empty.<sup id="_cha-12_footnote-ref-4" class="footnote"><a href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-4">4</a></sup></p>
<p>The result of putting Cases (1)(4) together is the <code>update</code> action shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_update_action" class="hyperref">Listing&nbsp;<span class="ref">12.16</span></a>.</p>
<div class="codelisting" id="_code-password_reset_update_action" data-tralics-id="uid1529" data-number="12.16"><div class="heading"><span class="number">Listing 12.16:</span> 

<span class="description">The <code>update</code> action for password reset.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/password_resets_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PasswordResetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:get_user</span><span class="p">,</span>         <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
  <span class="n">before_action</span> <span class="ss">:valid_user</span><span class="p">,</span>       <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
<span class="hll">  <span class="n">before_action</span> <span class="ss">:check_expiration</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>    <span class="c1"># Case (1)</span>
</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password_reset</span><span class="o">][</span><span class="ss">:email</span><span class="o">].</span><span class="n">downcase</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@user</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">create_reset_digest</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">send_password_reset_email</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:info</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Email sent with password reset instructions"</span>
      <span class="n">redirect_to</span> <span class="n">root_url</span>
    <span class="k">else</span>
      <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">[</span><span class="ss">:danger</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Email address not found"</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
<span class="hll">    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">][</span><span class="ss">:password</span><span class="o">].</span><span class="n">empty?</span>                  <span class="c1"># Case (3)</span>
</span>      <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:password</span><span class="p">,</span> <span class="s2">"can't be empty"</span><span class="p">)</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
<span class="hll">    <span class="k">elsif</span> <span class="vi">@user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>          <span class="c1"># Case (4)</span>
</span>      <span class="n">log_in</span> <span class="vi">@user</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Password has been reset."</span>
      <span class="n">redirect_to</span> <span class="vi">@user</span>
    <span class="k">else</span>
<span class="hll">      <span class="n">render</span> <span class="s1">'edit'</span>                                     <span class="c1"># Case (2)</span>
</span>    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">user_params</span>
<span class="hll">      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:password</span><span class="p">,</span> <span class="ss">:password_confirmation</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="c1"># Before filters</span>

    <span class="k">def</span> <span class="nf">get_user</span>
      <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Confirms a valid user.</span>
    <span class="k">def</span> <span class="nf">valid_user</span>
      <span class="k">unless</span> <span class="p">(</span><span class="vi">@user</span> <span class="o">&amp;&amp;</span> <span class="vi">@user</span><span class="o">.</span><span class="n">activated?</span> <span class="o">&amp;&amp;</span>
              <span class="vi">@user</span><span class="o">.</span><span class="n">authenticated?</span><span class="p">(</span><span class="ss">:reset</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">))</span>
        <span class="n">redirect_to</span> <span class="n">root_url</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># Checks expiration of reset token.</span>
<span class="hll">    <span class="k">def</span> <span class="nf">check_expiration</span>
</span>      <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_reset_expired?</span>
        <span class="n">flash</span><span class="o">[</span><span class="ss">:danger</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Password reset has expired."</span>
        <span class="n">redirect_to</span> <span class="n">new_password_reset_url</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>Note that weve added a <code>user_params</code> method permitting both the password and password confirmation attributes (<a href="https://www.railstutorial.org/book/sign_up#sec-strong_parameters" class="hyperref">Section&nbsp;<span class="ref">7.3.2</span></a>).</p>
<p>As noted above, the implementation in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_update_action" class="hyperref">Listing&nbsp;<span class="ref">12.16</span></a> delegates the boolean test for password reset expiration to the User model via the code</p>
<div class="code"><div class="highlight"><pre><span></span><span class="vi">@user</span><span class="o">.</span><span class="n">password_reset_expired?</span>
</pre></div></div>
<p>To get this to work, we need to define the <code>password_reset_expired?</code> method.<span class="intersentencespace"></span> As indicated in the email templates from <a href="https://www.railstutorial.org/book/password_reset#sec-password_reset_mailer" class="hyperref">Section&nbsp;<span class="ref">12.2.1</span></a>, well consider a password reset to be expired if it was sent more than two hours ago, which we can express in Ruby as follows:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">reset_sent_at</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span>
</pre></div></div>
<p>This can be confusing if you read <code>&lt;</code> as less than, because then it sounds like Password reset sent less than two hours ago, which is the opposite of what we want.<span class="intersentencespace"></span> In this context, its better to read <code>&lt;</code> as earlier than, which gives something like Password reset sent earlier than two hours ago.<span class="intersentencespace"></span> That <em>is</em> what we want, and it leads to the <code>password_reset_expired?</code> method in <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset_expired" class="hyperref">Listing&nbsp;<span class="ref">12.17</span></a>.<span class="intersentencespace"></span> (For a formal demonstration that the comparison is correct, see the proof in <a href="https://www.railstutorial.org/book/password_reset#sec-expiration_proof" class="hyperref">Section&nbsp;<span class="ref">12.6</span></a>.)</p>
<div class="codelisting" id="_code-user_model_password_reset_expired" data-tralics-id="uid1530" data-number="12.17"><div class="heading"><span class="number">Listing 12.17:</span> 

<span class="description">Adding password reset methods to the User model.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/user.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># Returns true if a password reset has expired.</span>
  <span class="k">def</span> <span class="nf">password_reset_expired?</span>
<span class="hll">    <span class="n">reset_sent_at</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span>
</span>  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
<span class="k">end</span>
</pre></div></div></div><p>With the code in <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset_expired" class="hyperref">Listing&nbsp;<span class="ref">12.17</span></a>, the <code>update</code> action in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_update_action" class="hyperref">Listing&nbsp;<span class="ref">12.16</span></a> should be working.<span class="intersentencespace"></span> The results for invalid and valid submissions are shown in <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_failure" class="hyperref">Figure&nbsp;<span class="ref">12.12</span></a> and <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_success" class="hyperref">Figure&nbsp;<span class="ref">12.13</span></a>, respectively.<span class="intersentencespace"></span> (Lacking the patience to wait two hours, well cover the third branch in a test, which is left as an exercise (<a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_test" class="hyperref">Section&nbsp;<span class="ref">12.3.3.1</span></a>).)</p>
<div class="center figure" id="_fig-password_reset_failure" data-tralics-id="uid1531" data-number="12.12">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/password_reset_failure_4th_ed.png" alt="images/figures/password_reset_failure_4th_ed"></div><div class="caption"><span class="header">Figure 12.12: </span><span class="description">A failed password reset.
</span></div></div>
<div class="center figure" id="_fig-password_reset_success" data-tralics-id="uid1532" data-number="12.13">
<div class="graphics image"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/password_reset_success_4th_ed.png" alt="images/figures/password_reset_success_4th_ed"></div><div class="caption"><span class="header">Figure 12.13: </span><span class="description">A successful password reset.
</span></div></div>
<div id="_sec-exercises_updating_the_reset" data-tralics-id="uid1533" class="subsubsection" data-number="12.3.2.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_updating_the_reset" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Follow the email link from <a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_mailer" class="hyperref">Section&nbsp;<span class="ref">12.2.1.1</span></a> again and submit mismatched passwords to the form.<span class="intersentencespace"></span> What is the error message? <span class="exercise" id="ex-a3e543"></span>
</li>
<li>In the console, find the user belonging to the email link, and retrieve the value of the <code>password_digest</code> attribute.<span class="intersentencespace"></span> Now submit valid matching passwords to the form shown in <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_failure" class="hyperref">Figure&nbsp;<span class="ref">12.12</span></a>.<span class="intersentencespace"></span> Did the submission appear to work?<span class="intersentencespace"></span> How did it affect the value of <code>password_digest</code>?<span class="intersentencespace"></span> <em>Hint</em>: Use <code>user.reload</code> to retrieve the new value. <span class="exercise" id="ex-140f50"></span>
</li></ol>
</div></div>
<div id="_sec-password_reset_test" data-tralics-id="uid1536" class="subsection" data-number="12.3.3"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-password_reset_test" class="heading hyperref"><span class="number">12.3.3 </span>Password reset test</a></h3>
<p>In this section, well write an integration test covering two of the three branches in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_update_action" class="hyperref">Listing&nbsp;<span class="ref">12.16</span></a>, invalid and valid submission.<span class="intersentencespace"></span> (As noted above, testing the third branch is left as an exercise (<a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_test" class="hyperref">Section&nbsp;<span class="ref">12.3.3.1</span></a>).)<span class="intersentencespace"></span> Well get started by generating a test file for password resets:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> rails generate integration_test password_resets
<span class="go">      invoke  test_unit</span>
<span class="go">      create    test/integration/password_resets_test.rb</span>
</pre></div></div>
<p>The steps to test password resets broadly parallel the test for account activation from <a href="https://www.railstutorial.org/book/account_activation#code-signup_with_account_activation_test" class="hyperref">Listing&nbsp;<span class="ref">11.33</span></a>, though there is a difference at the outset: we first visit the forgot password form and submit invalid and then valid email addresses, the latter of which creates a password reset token and sends the reset email.<span class="intersentencespace"></span> We then visit the link from the email and again submit invalid and valid information, verifying the correct behavior in each case.<span class="intersentencespace"></span> The resulting test, shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_integration_test" class="hyperref">Listing&nbsp;<span class="ref">12.18</span></a>, is an excellent exercise in reading code.</p>
<div class="codelisting" id="_code-password_reset_integration_test" data-tralics-id="uid1537" data-number="12.18"><div class="heading"><span class="number">Listing 12.18:</span> 

<span class="description">An integration test for password resets.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/integration/password_resets_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">PasswordResetsTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">clear</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"password resets"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="n">new_password_reset_path</span>
    <span class="n">assert_template</span> <span class="s1">'password_resets/new'</span>
    <span class="c1"># Invalid email</span>
    <span class="n">post</span> <span class="n">password_resets_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password_reset</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">""</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert_not</span> <span class="n">flash</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">assert_template</span> <span class="s1">'password_resets/new'</span>
    <span class="c1"># Valid email</span>
    <span class="n">post</span> <span class="n">password_resets_path</span><span class="p">,</span>
         <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password_reset</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert_not_equal</span> <span class="vi">@user</span><span class="o">.</span><span class="n">reset_digest</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">reload</span><span class="o">.</span><span class="n">reset_digest</span>
    <span class="n">assert_equal</span> <span class="mi">1</span><span class="p">,</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">size</span>
    <span class="n">assert_not</span> <span class="n">flash</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">assert_redirected_to</span> <span class="n">root_url</span>
    <span class="c1"># Password reset form</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">assigns</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
    <span class="c1"># Wrong email</span>
    <span class="n">get</span> <span class="n">edit_password_reset_path</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">""</span><span class="p">)</span>
    <span class="n">assert_redirected_to</span> <span class="n">root_url</span>
    <span class="c1"># Inactive user</span>
    <span class="n">user</span><span class="o">.</span><span class="n">toggle!</span><span class="p">(</span><span class="ss">:activated</span><span class="p">)</span>
    <span class="n">get</span> <span class="n">edit_password_reset_path</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="n">assert_redirected_to</span> <span class="n">root_url</span>
    <span class="n">user</span><span class="o">.</span><span class="n">toggle!</span><span class="p">(</span><span class="ss">:activated</span><span class="p">)</span>
    <span class="c1"># Right email, wrong token</span>
    <span class="n">get</span> <span class="n">edit_password_reset_path</span><span class="p">(</span><span class="s1">'wrong token'</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="n">assert_redirected_to</span> <span class="n">root_url</span>
    <span class="c1"># Right email, right token</span>
    <span class="n">get</span> <span class="n">edit_password_reset_path</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="n">assert_template</span> <span class="s1">'password_resets/edit'</span>
    <span class="n">assert_select</span> <span class="s2">"input[name=email][type=hidden][value=?]"</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span>
    <span class="c1"># Invalid password &amp; confirmation</span>
    <span class="n">patch</span> <span class="n">password_reset_path</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">),</span>
          <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                    <span class="ss">user</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password</span><span class="p">:</span>              <span class="s2">"foobaz"</span><span class="p">,</span>
                            <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"barquux"</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert_select</span> <span class="s1">'div#error_explanation'</span>
    <span class="c1"># Empty password</span>
    <span class="n">patch</span> <span class="n">password_reset_path</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">),</span>
          <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                    <span class="ss">user</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password</span><span class="p">:</span>              <span class="s2">""</span><span class="p">,</span>
                            <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">""</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert_select</span> <span class="s1">'div#error_explanation'</span>
    <span class="c1"># Valid password &amp; confirmation</span>
    <span class="n">patch</span> <span class="n">password_reset_path</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">),</span>
          <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                    <span class="ss">user</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password</span><span class="p">:</span>              <span class="s2">"foobaz"</span><span class="p">,</span>
                            <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobaz"</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="n">is_logged_in?</span>
    <span class="n">assert_not</span> <span class="n">flash</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">assert_redirected_to</span> <span class="n">user</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>Most of the ideas in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_integration_test" class="hyperref">Listing&nbsp;<span class="ref">12.18</span></a> have appeared previously in this tutorial; the only really novel element is the test of the <code>input</code> tag:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">assert_select</span> <span class="s2">"input[name=email][type=hidden][value=?]"</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span>
</pre></div></div>
<p>This makes sure that there is an <code>input</code> tag with the right name, (hidden) type, and email address:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">"email"</span> <span class="na">name</span><span class="o">=</span><span class="s">"email"</span> <span class="na">type</span><span class="o">=</span><span class="s">"hidden"</span> <span class="na">value</span><span class="o">=</span><span class="s">"michael@example.com"</span> <span class="p">/&gt;</span>
</pre></div></div>
<p>With the code as in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_integration_test" class="hyperref">Listing&nbsp;<span class="ref">12.18</span></a>, our test suite should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="_uid1538" data-tralics-id="uid1538" data-number="12.19"><div class="heading"><span class="number">Listing 12.19:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre><span></span>$ rails test
</pre></div></div></div>
<div id="_sec-exercises_password_reset_test" data-tralics-id="uid1539" class="subsubsection" data-number="12.3.3.1"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_password_reset_test" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>In <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.6</span></a>, the <code>create_reset_digest</code> method makes two calls to <code>update_attribute</code>, each of which requires a separate database operation.<span class="intersentencespace"></span> By filling in the template shown in <a href="https://www.railstutorial.org/book/password_reset#code-update_columns_redux" class="hyperref">Listing&nbsp;<span class="ref">12.20</span></a>, replace the two <code>update_attribute</code> calls with a single call to <code>update_columns</code>, which hits the database only once.<span class="intersentencespace"></span> After making the changes, verify that the test suite is still <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>.<span class="intersentencespace"></span> (For convenience, <a href="https://www.railstutorial.org/book/password_reset#code-update_columns_redux" class="hyperref">Listing&nbsp;<span class="ref">12.20</span></a> includes the results of solving the exercise in <a href="https://www.railstutorial.org/book/account_activation#code-update_columns" class="hyperref">Listing&nbsp;<span class="ref">11.39</span></a>.) <span class="exercise" id="ex-697d08"></span>
</li>
<li>Write an integration test for the expired password reset branch in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_update_action" class="hyperref">Listing&nbsp;<span class="ref">12.16</span></a> by filling in the template shown in <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_expire_test" class="hyperref">Listing&nbsp;<span class="ref">12.21</span></a>.<span class="intersentencespace"></span> (This code introduces <code>response.body</code>, which returns the full HTML body of the page.)<span class="intersentencespace"></span> There are many ways to test for the result of an expiration, but the method suggested by <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_expire_test" class="hyperref">Listing&nbsp;<span class="ref">12.21</span></a> is to (case-insensitively) check that the response body includes the word expired. <span class="exercise" id="ex-06cd0f"></span>
</li>
<li>Expiring password resets after a couple of hours is a nice security precaution, but there is an even more secure solution for cases where a public computer is used.<span class="intersentencespace"></span> The reason is that the password reset link remains active for 2 hours and can be used even if logged out.<span class="intersentencespace"></span> If a user reset their password from a public machine, anyone could press the back button and change the password (and get logged in to the site).<span class="intersentencespace"></span> To fix this, add the code shown in <a href="https://www.railstutorial.org/book/password_reset#code-update_clear_reset" class="hyperref">Listing&nbsp;<span class="ref">12.22</span></a> to clear the reset digest on successful password update.<sup id="_cha-12_footnote-ref-5" class="footnote intersentence"><a href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-5">5</a></sup><span class="intersentencespace"></span> <span class="exercise" id="ex-680ffb"></span>
</li>
<li>Add a line to <a href="https://www.railstutorial.org/book/password_reset#code-password_reset_integration_test" class="hyperref">Listing&nbsp;<span class="ref">12.18</span></a> to test for the clearing of the reset digest in the previous exercise.<span class="intersentencespace"></span> <em>Hint</em>: Combine <code>assert_nil</code> (first seen in <a href="https://www.railstutorial.org/book/advanced_login#code-remember_me_test" class="hyperref">Listing&nbsp;<span class="ref">9.25</span></a>) with <code>user.reload</code> (<a href="https://www.railstutorial.org/book/account_activation#code-signup_with_account_activation_test" class="hyperref">Listing&nbsp;<span class="ref">11.33</span></a>) to test the <code>reset_digest</code> attribute directly. <span class="exercise" id="ex-52ff2f"></span>
</li></ol>
<div class="codelisting" id="_code-update_columns_redux" data-tralics-id="uid1545" data-number="12.20"><div class="heading"><span class="number">Listing 12.20:</span> 

<span class="description">A template for using <code>update_columns</code>.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/user.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">attr_accessor</span> <span class="ss">:remember_token</span><span class="p">,</span> <span class="ss">:activation_token</span><span class="p">,</span> <span class="ss">:reset_token</span>
  <span class="n">before_save</span>   <span class="ss">:downcase_email</span>
  <span class="n">before_create</span> <span class="ss">:create_activation_digest</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># Activates an account.</span>
  <span class="k">def</span> <span class="nf">activate</span>
    <span class="n">update_columns</span><span class="p">(</span><span class="ss">activated</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">activated_at</span><span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Sends activation email.</span>
  <span class="k">def</span> <span class="nf">send_activation_email</span>
    <span class="no">UserMailer</span><span class="o">.</span><span class="n">account_activation</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
  <span class="k">end</span>

  <span class="c1"># Sets the password reset attributes.</span>
  <span class="k">def</span> <span class="nf">create_reset_digest</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">reset_token</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
<span class="hll">    <span class="n">update_columns</span><span class="p">(</span><span class="ss">reset_digest</span><span class="p">:</span>  <span class="no">FILL_IN</span><span class="p">,</span> <span class="ss">reset_sent_at</span><span class="p">:</span> <span class="no">FILL_IN</span><span class="p">)</span>
</span>  <span class="k">end</span>

  <span class="c1"># Sends password reset email.</span>
  <span class="k">def</span> <span class="nf">send_password_reset_email</span>
    <span class="no">UserMailer</span><span class="o">.</span><span class="n">password_reset</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="c1"># Converts email to all lower-case.</span>
    <span class="k">def</span> <span class="nf">downcase_email</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span>
    <span class="k">end</span>

    <span class="c1"># Creates and assigns the activation token and digest.</span>
    <span class="k">def</span> <span class="nf">create_activation_digest</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">activation_token</span>  <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new_token</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">activation_digest</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">activation_token</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><div class="codelisting" id="_code-password_reset_expire_test" data-tralics-id="uid1546" data-number="12.21"><div class="heading"><span class="number">Listing 12.21:</span> 

<span class="description">A test for an expired password reset.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/integration/password_resets_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">PasswordResetsTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">clear</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"expired token"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="n">new_password_reset_path</span>
    <span class="n">post</span> <span class="n">password_resets_path</span><span class="p">,</span>
         <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password_reset</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="p">}</span> <span class="p">}</span>

    <span class="vi">@user</span> <span class="o">=</span> <span class="n">assigns</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:reset_sent_at</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span><span class="p">)</span>
    <span class="n">patch</span> <span class="n">password_reset_path</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">reset_token</span><span class="p">),</span>
          <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">email</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                    <span class="ss">user</span><span class="p">:</span> <span class="p">{</span> <span class="ss">password</span><span class="p">:</span>              <span class="s2">"foobar"</span><span class="p">,</span>
                            <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert_response</span> <span class="ss">:redirect</span>
    <span class="n">follow_redirect!</span>
<span class="hll">    <span class="n">assert_match</span> <span class="sr">/FILL_IN/i</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><div class="codelisting" id="_code-update_clear_reset" data-tralics-id="uid1547" data-number="12.22"><div class="heading"><span class="number">Listing 12.22:</span> 

<span class="description">Clearing the reset digest on successful password reset.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/password_resets_controller.rb</code> </span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PasswordResetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">][</span><span class="ss">:password</span><span class="o">].</span><span class="n">empty?</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:password</span><span class="p">,</span> <span class="s2">"can't be empty"</span><span class="p">)</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
    <span class="k">elsif</span> <span class="vi">@user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
      <span class="n">log_in</span> <span class="vi">@user</span>
<span class="hll">      <span class="vi">@user</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:reset_digest</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>
</span>      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Password has been reset."</span>
      <span class="n">redirect_to</span> <span class="vi">@user</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div></div></div></div></div><div id="_sec-reset_email_in_production" data-tralics-id="cid70" class="section" data-number="12.4"><h2><a href="https://www.railstutorial.org/book/password_reset#sec-reset_email_in_production" class="heading hyperref"><span class="number">12.4 </span>Email in production (take two)</a></h2>
<p>Now that weve got password resets working in development, in this section well get them working in production as well.<span class="intersentencespace"></span> The steps are exactly the same as for account activations, so if you already followed <a href="https://www.railstutorial.org/book/account_activation#sec-activation_email_in_production" class="hyperref">Section&nbsp;<span class="ref">11.4</span></a> you can skip right to <a href="https://www.railstutorial.org/book/password_reset#code-merge_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.24</span></a>.</p>
<p>To send email in production, well use SendGrid, which is available as an add-on at Heroku for verified accounts.<span class="intersentencespace"></span> (This requires adding credit card information to your Heroku account, but there is no charge when verifying an account.)<span class="intersentencespace"></span> For our purposes, the starter tier (which as of this writing is limited to 400 emails a day but costs nothing) is the best fit.<span class="intersentencespace"></span> We can add it to our app as follows:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> heroku addons:create sendgrid:starter
</pre></div></div>
<p>(This might fail on systems with older version of Herokus command-line interface.<span class="intersentencespace"></span> In this case, either <a href="https://toolbelt.heroku.com/" target="_blank" rel="noopener">upgrade to the latest Heroku toolbelt</a> or try the older syntax <code>heroku addons:add sendgrid:starter</code>.)</p>
<p>To configure our application to use SendGrid, we need to fill out the <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank" rel="noopener">SMTP</a> settings for our production environment.<span class="intersentencespace"></span> As shown in <a href="https://www.railstutorial.org/book/password_reset#code-sendgrid_config_redux" class="hyperref">Listing&nbsp;<span class="ref">12.23</span></a>, you will also have to define a <code>host</code> variable with the address of your production website.</p>
<div class="codelisting" id="_code-sendgrid_config_redux" data-tralics-id="uid1548" data-number="12.23"><div class="heading"><span class="number">Listing 12.23:</span> 

<span class="description">Configuring Rails to use SendGrid in production.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">config/environments/production.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">raise_delivery_errors</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>
  <span class="n">host</span> <span class="o">=</span> <span class="s1">'&lt;your heroku app&gt;.herokuapp.com'</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">host</span><span class="p">:</span> <span class="n">host</span> <span class="p">}</span>
  <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">:address</span>        <span class="o">=&gt;</span> <span class="s1">'smtp.sendgrid.net'</span><span class="p">,</span>
    <span class="ss">:port</span>           <span class="o">=&gt;</span> <span class="s1">'587'</span><span class="p">,</span>
    <span class="ss">:authentication</span> <span class="o">=&gt;</span> <span class="ss">:plain</span><span class="p">,</span>
    <span class="ss">:user_name</span>      <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'SENDGRID_USERNAME'</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:password</span>       <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'SENDGRID_PASSWORD'</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:domain</span>         <span class="o">=&gt;</span> <span class="s1">'heroku.com'</span><span class="p">,</span>
    <span class="ss">:enable_starttls_auto</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="p">}</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div></div><p>The email configuration in <a href="https://www.railstutorial.org/book/account_activation#code-sendgrid_config" class="hyperref">Listing&nbsp;<span class="ref">11.41</span></a> includes the <code>user_name</code> and <code>password</code> of the SendGrid account, but note that they are accessed via the <code>ENV</code> environment variable instead of being hard-coded.<span class="intersentencespace"></span> This is a best practice for production applications, which for security reasons should never expose sensitive information such as raw passwords in source code.<span class="intersentencespace"></span> In the present case, these variables are configured automatically via the SendGrid add-on, but well see an example in <a href="https://www.railstutorial.org/book/user_microposts#sec-image_upload_in_production" class="hyperref">Section&nbsp;<span class="ref">13.4.4</span></a> where well have to define them ourselves.</p>
<p>At this point, you should merge the topic branch into master (<a href="https://www.railstutorial.org/book/password_reset#code-merge_password_reset" class="hyperref">Listing&nbsp;<span class="ref">12.24</span></a>).</p>
<div class="codelisting" id="_code-merge_password_reset" data-tralics-id="uid1549" data-number="12.24"><div class="heading"><span class="number">Listing 12.24:</span> 

<span class="description">Merging the <code>password-reset</code> branch into <code>master</code>.</span>
</div>

<div class="code"><div class="highlight"><pre><span></span>$ rails test
$ git add -A
$ git commit -m "Add password reset"
$ git checkout master
$ git merge password-reset
</pre></div></div></div><p>Then push up to the remote repository and deploy to Heroku:</p>
<div class="code"><div class="highlight"><pre><span></span>$ rails test
$ git push
$ git push heroku
$ heroku run rails db:migrate
</pre></div></div>
<p>Once the Heroku deploy has finished, you can reset your password by clicking the (forgot password) link (<a href="https://www.railstutorial.org/book/password_reset#fig-forgot_password_link" class="hyperref">Figure&nbsp;<span class="ref">12.4</span></a>).<span class="intersentencespace"></span> The result should be a reset email as shown in <a href="https://www.railstutorial.org/book/password_reset#fig-reset_email_production" class="hyperref">Figure&nbsp;<span class="ref">12.14</span></a>.<span class="intersentencespace"></span> Following the link and making invalid or valid submissions should work as it did in development (<a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_failure" class="hyperref">Figure&nbsp;<span class="ref">12.12</span></a> and <a href="https://www.railstutorial.org/book/password_reset#fig-password_reset_success" class="hyperref">Figure&nbsp;<span class="ref">12.13</span></a>).</p>
<div class="center figure" id="_fig-reset_email_production" data-tralics-id="uid1550" data-number="12.14">
<div class="graphics image box"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/reset_email_production_4th_ed.png" alt="images/figures/reset_email_production_4th_ed"></div><div class="caption"><span class="header">Figure 12.14: </span><span class="description">A password reset email sent in production.
</span></div></div>
<div id="_sec-exercises_reset_email_in_production" data-tralics-id="uid1551" class="subsubsection" data-number="12.4.3.2"><h4><a href="https://www.railstutorial.org/book/password_reset#sec-exercises_reset_email_in_production" class="heading">Exercises</a></h4>
<p> </p><div class="society-note">
<p>Solutions to exercises are available for free at <a href="http://railstutorial.org/solutions" target="_blank" rel="noopener">railstutorial.org/solutions</a> with any Rails Tutorial purchase.<span class="intersentencespace"></span> To see other peoples answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p></div>
<ol>
<li>Sign up for a new account in production.<span class="intersentencespace"></span> Did you get the email? <span class="exercise" id="ex-6c5c45"></span>
</li>
<li>Click on the link in the activation email to confirm that it works.<span class="intersentencespace"></span> What is the corresponding entry in the server log?<span class="intersentencespace"></span> <em>Hint</em>: Run <code>heroku logs</code> at the command line. <span class="exercise" id="ex-59f9aa"></span>
</li>
<li>Are you able to successfully update your password? <span class="exercise" id="ex-f449af"></span>
</li></ol>
</div></div><div id="_sec-resets_conclusion" data-tralics-id="cid71" class="section" data-number="12.5"><h2><a href="https://www.railstutorial.org/book/password_reset#sec-resets_conclusion" class="heading hyperref"><span class="number">12.5 </span>Conclusion</a></h2>
<p>With the added password resets, our sample applications sign up, log in, and log out machinery is complete and professional-grade.<span class="intersentencespace"></span> The rest of the <em>Ruby on Rails Tutorial</em> builds on this foundation to make a site with Twitter-like microposts (<a href="https://www.railstutorial.org/book/user_microposts#cha-user_microposts" class="hyperref">Chapter&nbsp;<span class="ref">13</span></a>) and a status feed of posts from followed users (<a href="https://www.railstutorial.org/book/following_users#cha-following_users" class="hyperref">Chapter&nbsp;<span class="ref">14</span></a>).<span class="intersentencespace"></span> In the process, well learn about some of the most powerful features of Rails, including image upload, custom database queries, and advanced data modeling with <code>has_many</code> and <code>has_many :through</code>.</p>
<div id="_sec-activation_resets_what_we_learned_in_this_chapter" data-tralics-id="uid1555" class="subsection" data-number="12.5.1"><h3><a href="https://www.railstutorial.org/book/password_reset#sec-activation_resets_what_we_learned_in_this_chapter" class="heading hyperref"><span class="number">12.5.1 </span>What we learned in this chapter</a></h3>
<ul>
<li>Like sessions and account activations, password resets can be modeled as a resource despite not being Active Record objects.
</li>
<li>Rails can generate Action Mailer actions and views to send email.
</li>
<li>Action Mailer supports both plain-text and HTML mail.
</li>
<li>As with ordinary actions and views, instance variables defined in mailer actions are available in mailer views.
</li>
<li>Password resets use a generated token to create a unique URL for resetting passwords.
</li>
<li>Password resets use a hashed reset digest to securely identify valid reset requests.
</li>
<li>Both mailer tests and integration tests are useful for verifying the behavior of the User mailer.
</li>
<li>We can send email in production using SendGrid.
</li></ul>
</div></div><div id="_sec-expiration_proof" data-tralics-id="cid72" class="section" data-number="12.6"><h2><a href="https://www.railstutorial.org/book/password_reset#sec-expiration_proof" class="heading hyperref"><span class="number">12.6 </span>Proof of expiration comparison</a></h2>
<p>We saw in <a href="https://www.railstutorial.org/book/password_reset#sec-resetting_the_password" class="hyperref">Section&nbsp;<span class="ref">12.3</span></a> that the comparison test for determining when a password reset has expired is</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">reset_sent_at</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span>
</pre></div></div>
<p>as seen in <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset_expired" class="hyperref">Listing&nbsp;<span class="ref">12.17</span></a>.<span class="intersentencespace"></span> This looks likes it might be read as reset sent less than two hours ago, which is the opposite of what we want.<span class="intersentencespace"></span> In this section, well prove that the above comparison is correct.<sup id="_cha-12_footnote-ref-6" class="footnote"><a href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-6">6</a></sup></p>
<p>We start by defining two time intervals.<span class="intersentencespace"></span> Let <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 1.804em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.592em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.275em, 1001.59em, 2.493em, -999.997em); top: -2.17em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-4"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-6" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.175em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.232em; border-left: 0px solid; width: 0px; height: 1.062em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>r</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-1"> \Delta t_r </script></span> be the time interval since sending the password reset and <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 1.804em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.592em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.275em, 1001.59em, 2.493em, -999.997em); top: -2.17em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-10"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-12" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.175em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.232em; border-left: 0px solid; width: 0px; height: 1.062em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>e</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> \Delta t_e </script></span> be the expiration time limit (e.g., two hours).<span class="intersentencespace"></span> A password reset has expired if the time interval since the reset was sent is greater than the expiration limit:</p>
<div id="_eq-time_delta" data-tralics-id="uid1565" data-number="12.1" class="equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-eqtime_delta&quot;&gt;&lt;mtext&gt;(12.1)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-13" style="width: 100%; display: inline-block; min-width: 11.502em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 111%; min-width: 11.502em;"><span style="position: absolute; clip: rect(3.023em, 1004.72em, 4.401em, -999.997em); top: -3.972em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-14"><span class="mtable" id="MathJax-Span-15" style="min-width: 11.502em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 11.502em;"><span style="display: inline-block; position: absolute; width: 4.772em; height: 0px; clip: rect(-0.951em, 1004.72em, 0.427em, -999.997em); top: 0em; left: 50%; margin-left: -2.382em;"><span style="position: absolute; clip: rect(3.129em, 1004.72em, 4.295em, -999.997em); top: -3.972em; left: 0em;"><span style="display: inline-block; position: relative; width: 4.772em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1004.72em, 4.295em, -999.997em); top: -3.972em; left: 50%; margin-left: -2.382em;"><span class="mtd" id="MathJax-Span-19"><span class="mrow" id="MathJax-Span-20"><span class="mi" id="MathJax-Span-21" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-22"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-24" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-25" style="font-family: MathJax_Main; padding-left: 0.268em;">&gt;</span><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Main; padding-left: 0.268em;"></span><span class="msubsup" id="MathJax-Span-27"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-28" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-29" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-30" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; position: absolute; width: 2.546em; height: 0px; clip: rect(-0.898em, 1002.44em, 0.427em, -999.997em); top: 0em; right: 0em; margin-right: 0em;"><span style="position: absolute; clip: rect(3.076em, 1002.44em, 4.401em, -999.997em); top: -3.972em; right: 0em;"><span class="mtd" id="mjx-eqn-eqtime_delta"><span class="mrow" id="MathJax-Span-17"><span class="mtext" id="MathJax-Span-18" style="font-family: MathJax_Main;">(12.1)</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.35em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-eqtime_delta"><mtext>(12.1)</mtext></mtd><mtd><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>r</mi></msub><mo>&gt;</mo><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>e</mi></msub><mo>.</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-3">\begin{equation}
\label{eq:time_delta}
\Delta t_r > \Delta t_e.
\end{equation}</script>
</div><p>If we write the time now as <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-31" style="width: 1.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.063em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.328em, 1001.06em, 2.44em, -999.997em); top: -2.117em; left: 0em;"><span class="mrow" id="MathJax-Span-32"><span class="msubsup" id="MathJax-Span-33"><span style="display: inline-block; position: relative; width: 1.063em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-35" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.122em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.232em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mi>N</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-4"> t_N </script></span>, the password reset sending time as <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-36" style="width: 0.851em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.328em, 1000.75em, 2.44em, -999.997em); top: -2.117em; left: 0em;"><span class="mrow" id="MathJax-Span-37"><span class="msubsup" id="MathJax-Span-38"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-40" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.122em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.232em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mi>r</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-5"> t_r </script></span>, and the expiration time as <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 0.851em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.328em, 1000.75em, 2.44em, -999.997em); top: -2.117em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="msubsup" id="MathJax-Span-43"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-45" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.122em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.232em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mi>e</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6"> t_e </script></span> (e.g., two hours ago), then we have</p>
<div id="_eq-delta_p" data-tralics-id="uid1566" data-number="12.2" class="equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-eqdelta_p&quot;&gt;&lt;mtext&gt;(12.2)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-46" style="width: 100%; display: inline-block; min-width: 12.668em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 111%; min-width: 12.668em;"><span style="position: absolute; clip: rect(3.023em, 1005.94em, 4.401em, -999.997em); top: -3.972em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-47"><span class="mtable" id="MathJax-Span-48" style="min-width: 12.668em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 12.668em;"><span style="display: inline-block; position: absolute; width: 5.938em; height: 0px; clip: rect(-0.951em, 1005.94em, 0.427em, -999.997em); top: 0em; left: 50%; margin-left: -2.965em;"><span style="position: absolute; clip: rect(3.129em, 1005.94em, 4.295em, -999.997em); top: -3.972em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.938em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1005.94em, 4.295em, -999.997em); top: -3.972em; left: 50%; margin-left: -2.965em;"><span class="mtd" id="MathJax-Span-52"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-55"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-56" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-57" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-58" style="font-family: MathJax_Main; padding-left: 0.268em;">=</span><span class="msubsup" id="MathJax-Span-59" style="padding-left: 0.268em;"><span style="display: inline-block; position: relative; width: 1.063em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-60" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-61" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-62" style="font-family: MathJax_Main; padding-left: 0.215em;"></span><span class="msubsup" id="MathJax-Span-63" style="padding-left: 0.215em;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-65" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; position: absolute; width: 2.546em; height: 0px; clip: rect(-0.898em, 1002.44em, 0.427em, -999.997em); top: 0em; right: 0em; margin-right: 0em;"><span style="position: absolute; clip: rect(3.076em, 1002.44em, 4.401em, -999.997em); top: -3.972em; right: 0em;"><span class="mtd" id="mjx-eqn-eqdelta_p"><span class="mrow" id="MathJax-Span-50"><span class="mtext" id="MathJax-Span-51" style="font-family: MathJax_Main;">(12.2)</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.35em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-eqdelta_p"><mtext>(12.2)</mtext></mtd><mtd><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>r</mi></msub><mo>=</mo><msub><mi>t</mi><mi>N</mi></msub><mo></mo><msub><mi>t</mi><mi>r</mi></msub></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-7">\begin{equation}
\label{eq:delta_p}
\Delta t_r = t_N - t_r
\end{equation}</script>
</div><p>and</p>
<div id="_eq-delta_e" data-tralics-id="uid1567" data-number="12.3" class="equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-eqdelta_e&quot;&gt;&lt;mtext&gt;(12.3)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-66" style="width: 100%; display: inline-block; min-width: 12.933em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 111%; min-width: 12.933em;"><span style="position: absolute; clip: rect(3.023em, 1006.15em, 4.401em, -999.997em); top: -3.972em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-67"><span class="mtable" id="MathJax-Span-68" style="min-width: 12.933em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 12.933em;"><span style="display: inline-block; position: absolute; width: 6.256em; height: 0px; clip: rect(-0.951em, 1006.15em, 0.427em, -999.997em); top: 0em; left: 50%; margin-left: -3.124em;"><span style="position: absolute; clip: rect(3.129em, 1006.15em, 4.295em, -999.997em); top: -3.972em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.256em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1006.15em, 4.295em, -999.997em); top: -3.972em; left: 50%; margin-left: -3.124em;"><span class="mtd" id="MathJax-Span-72"><span class="mrow" id="MathJax-Span-73"><span class="mi" id="MathJax-Span-74" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-75"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-76" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-77" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-78" style="font-family: MathJax_Main; padding-left: 0.268em;">=</span><span class="msubsup" id="MathJax-Span-79" style="padding-left: 0.268em;"><span style="display: inline-block; position: relative; width: 1.063em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-81" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main; padding-left: 0.215em;"></span><span class="msubsup" id="MathJax-Span-83" style="padding-left: 0.215em;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-84" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-85" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; position: absolute; width: 2.546em; height: 0px; clip: rect(-0.898em, 1002.44em, 0.427em, -999.997em); top: 0em; right: 0em; margin-right: 0em;"><span style="position: absolute; clip: rect(3.076em, 1002.44em, 4.401em, -999.997em); top: -3.972em; right: 0em;"><span class="mtd" id="mjx-eqn-eqdelta_e"><span class="mrow" id="MathJax-Span-70"><span class="mtext" id="MathJax-Span-71" style="font-family: MathJax_Main;">(12.3)</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.35em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-eqdelta_e"><mtext>(12.3)</mtext></mtd><mtd><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>e</mi></msub><mo>=</mo><msub><mi>t</mi><mi>N</mi></msub><mo></mo><msub><mi>t</mi><mi>e</mi></msub><mo>.</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-8">\begin{equation}
\label{eq:delta_e}
\Delta t_e = t_N - t_e.
\end{equation}</script>
</div><p>Plugging <a href="https://www.railstutorial.org/book/password_reset#eq-delta_p" class="hyperref">Eq.&nbsp;(<span class="ref">12.2</span>)</a> and <a href="https://www.railstutorial.org/book/password_reset#eq-delta_e" class="hyperref">Eq.&nbsp;(<span class="ref">12.3</span>)</a> into <a href="https://www.railstutorial.org/book/password_reset#eq-time_delta" class="hyperref">(<span class="ref">12.1</span>)</a> then gives</p>
<div class="equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-87" style="width: 10.178em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.171em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(-0.209em, 1009.01em, 3.924em, -999.997em); top: -2.117em; left: 0em;"><span class="mrow" id="MathJax-Span-88"><span class="mtable" id="MathJax-Span-89" style="padding-right: 0.162em; padding-left: 0.162em;"><span style="display: inline-block; position: relative; width: 8.853em; height: 0px;"><span style="position: absolute; clip: rect(2.44em, 1003.02em, 6.415em, -999.997em); top: -4.661em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.023em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1001.59em, 4.295em, -999.997em); top: -5.297em; right: 0em;"><span class="mtd" id="MathJax-Span-90"><span class="mrow" id="MathJax-Span-91"><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-93"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-94" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-95" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; clip: rect(3.182em, 1003.02em, 4.295em, -999.997em); top: -3.919em; right: 0em;"><span class="mtd" id="MathJax-Span-105"><span class="mrow" id="MathJax-Span-106"><span class="msubsup" id="MathJax-Span-107"><span style="display: inline-block; position: relative; width: 1.063em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main; padding-left: 0.215em;"></span><span class="msubsup" id="MathJax-Span-111" style="padding-left: 0.215em;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-112" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-113" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; clip: rect(3.182em, 1001.54em, 4.295em, -999.997em); top: -2.541em; right: 0em;"><span class="mtd" id="MathJax-Span-126"><span class="mrow" id="MathJax-Span-127"><span class="mo" id="MathJax-Span-128" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-129"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-130" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-131" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.666em;"></span></span><span style="position: absolute; clip: rect(2.334em, 1000.69em, 6.044em, -999.997em); top: -4.396em; left: 4.03em;"><span style="display: inline-block; position: relative; width: 0.798em; height: 0px;"><span style="position: absolute; clip: rect(3.288em, 1000.69em, 4.189em, -999.997em); top: -5.297em; left: 50%; margin-left: -0.368em;"><span class="mtd" id="MathJax-Span-96"><span class="mrow" id="MathJax-Span-97"><span class="mo" id="MathJax-Span-98" style="font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; clip: rect(3.288em, 1000.69em, 4.189em, -999.997em); top: -3.919em; left: 50%; margin-left: -0.368em;"><span class="mtd" id="MathJax-Span-114"><span class="mrow" id="MathJax-Span-115"><span class="mo" id="MathJax-Span-116" style="font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; clip: rect(3.288em, 1000.69em, 4.189em, -999.997em); top: -2.541em; left: 50%; margin-left: -0.368em;"><span class="mtd" id="MathJax-Span-132"><span class="mrow" id="MathJax-Span-133"><span class="mo" id="MathJax-Span-134" style="font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.401em;"></span></span><span style="position: absolute; clip: rect(2.493em, 1003.02em, 6.521em, -999.997em); top: -4.714em; left: 5.832em;"><span style="display: inline-block; position: relative; width: 3.023em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1001.59em, 4.295em, -999.997em); top: -5.297em; left: 0em;"><span class="mtd" id="MathJax-Span-99"><span class="mrow" id="MathJax-Span-100"><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-102"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-104" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; clip: rect(3.182em, 1003.02em, 4.295em, -999.997em); top: -3.919em; left: 0em;"><span class="mtd" id="MathJax-Span-117"><span class="mrow" id="MathJax-Span-118"><span class="msubsup" id="MathJax-Span-119"><span style="display: inline-block; position: relative; width: 1.063em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-120" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-121" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-122" style="font-family: MathJax_Main; padding-left: 0.215em;"></span><span class="msubsup" id="MathJax-Span-123" style="padding-left: 0.215em;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-125" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; clip: rect(3.182em, 1001.75em, 4.348em, -999.997em); top: -2.541em; left: 0em;"><span class="mtd" id="MathJax-Span-135"><span class="mrow" id="MathJax-Span-136"><span class="mo" id="MathJax-Span-137" style="font-family: MathJax_Main;"></span><span class="msubsup" id="MathJax-Span-138"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-139" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-140" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-141" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.719em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.122em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.879em; border-left: 0px solid; width: 0px; height: 4.356em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>r</mi></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd><mi mathvariant="normal"></mi><msub><mi>t</mi><mi>e</mi></msub></mtd></mtr><mtr><mtd><msub><mi>t</mi><mi>N</mi></msub><mo></mo><msub><mi>t</mi><mi>r</mi></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd><msub><mi>t</mi><mi>N</mi></msub><mo></mo><msub><mi>t</mi><mi>e</mi></msub></mtd></mtr><mtr><mtd><mo></mo><msub><mi>t</mi><mi>r</mi></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd><mo></mo><msub><mi>t</mi><mi>e</mi></msub><mo>,</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-9"> 
\begin{array}{rcl}
\Delta t_r & > & \Delta t_e \\
t_N - t_r & > & t_N - t_e \\
-t_r & > & -t_e,
\end{array}
 </script>
</div><p>which upon multiplying through by <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-142" style="width: 1.433em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.275em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.328em, 1001.22em, 2.44em, -999.997em); top: -2.17em; left: 0em;"><span class="mrow" id="MathJax-Span-143"><span class="mo" id="MathJax-Span-144" style="font-family: MathJax_Main;"></span><span class="mn" id="MathJax-Span-145" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.175em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.174em; border-left: 0px solid; width: 0px; height: 0.944em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo></mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-10"> -1 </script></span> yields</p>
<div id="_eq-time_comparison" data-tralics-id="uid1568" data-number="12.4" class="equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-eqtime_comparison&quot;&gt;&lt;mtext&gt;(12.4)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-146" style="width: 100%; display: inline-block; min-width: 9.807em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 111%; min-width: 9.807em;"><span style="position: absolute; clip: rect(3.023em, 1003.02em, 4.401em, -999.997em); top: -3.972em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-147"><span class="mtable" id="MathJax-Span-148" style="min-width: 9.807em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 9.807em;"><span style="display: inline-block; position: absolute; width: 3.129em; height: 0px; clip: rect(-0.951em, 1003.02em, 0.427em, -999.997em); top: 0em; left: 50%; margin-left: -1.534em;"><span style="position: absolute; clip: rect(3.235em, 1003.02em, 4.295em, -999.997em); top: -3.972em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.129em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1003.02em, 4.295em, -999.997em); top: -3.972em; left: 50%; margin-left: -1.534em;"><span class="mtd" id="MathJax-Span-152"><span class="mrow" id="MathJax-Span-153"><span class="msubsup" id="MathJax-Span-154"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-156" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-157" style="font-family: MathJax_Main; padding-left: 0.268em;">&lt;</span><span class="msubsup" id="MathJax-Span-158" style="padding-left: 0.268em;"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-159" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-160" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-161" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; position: absolute; width: 2.546em; height: 0px; clip: rect(-0.898em, 1002.44em, 0.427em, -999.997em); top: 0em; right: 0em; margin-right: 0em;"><span style="position: absolute; clip: rect(3.076em, 1002.44em, 4.401em, -999.997em); top: -3.972em; right: 0em;"><span class="mtd" id="mjx-eqn-eqtime_comparison"><span class="mrow" id="MathJax-Span-150"><span class="mtext" id="MathJax-Span-151" style="font-family: MathJax_Main;">(12.4)</span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.35em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-eqtime_comparison"><mtext>(12.4)</mtext></mtd><mtd><msub><mi>t</mi><mi>r</mi></msub><mo>&lt;</mo><msub><mi>t</mi><mi>e</mi></msub><mo>.</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-11">\begin{equation}
\label{eq:time_comparison}
t_r < t_e.
\end{equation}</script>
</div><p>Converting <a href="https://www.railstutorial.org/book/password_reset#eq-time_comparison" class="hyperref">(<span class="ref">12.4</span>)</a> to code with the value <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;h&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-162" style="width: 7.74em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.945em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.328em, 1006.89em, 2.546em, -999.997em); top: -2.17em; left: 0em;"><span class="mrow" id="MathJax-Span-163"><span class="msubsup" id="MathJax-Span-164"><span style="display: inline-block; position: relative; width: 0.745em; height: 0px;"><span style="position: absolute; clip: rect(3.182em, 1000.32em, 4.136em, -999.997em); top: -3.972em; left: 0em;"><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span><span style="position: absolute; top: -3.813em; left: 0.374em;"><span class="mi" id="MathJax-Span-166" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.977em;"></span></span></span></span><span class="mo" id="MathJax-Span-167" style="font-family: MathJax_Main; padding-left: 0.268em;">=</span><span class="texatom" id="MathJax-Span-168" style="padding-left: 0.268em;"><span class="mrow" id="MathJax-Span-169"><span class="mn" id="MathJax-Span-170" style="font-family: MathJax_Main;">2</span><span class="mtext" id="MathJax-Span-171" style="font-family: MathJax_Main;">&nbsp;</span><span class="mi" id="MathJax-Span-172" style="font-family: MathJax_Main;">h</span><span class="mi" id="MathJax-Span-173" style="font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-174" style="font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-175" style="font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-176" style="font-family: MathJax_Main;">s</span><span class="mtext" id="MathJax-Span-177" style="font-family: MathJax_Main;">&nbsp;</span><span class="mi" id="MathJax-Span-178" style="font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-179" style="font-family: MathJax_Main;">g</span><span class="mi" id="MathJax-Span-180" style="font-family: MathJax_Main;">o</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.175em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.291em; border-left: 0px solid; width: 0px; height: 1.121em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mi>e</mi></msub><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mtext>&nbsp;</mtext><mi mathvariant="normal">h</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">s</mi><mtext>&nbsp;</mtext><mi mathvariant="normal">a</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">o</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-12"> t_e = \mathrm{2\ hours\ ago} </script></span> gives the <code>password_reset_expired?</code> method shown in <a href="https://www.railstutorial.org/book/password_reset#code-user_model_password_reset_expired" class="hyperref">Listing&nbsp;<span class="ref">12.17</span></a>:</p>
<div class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">password_reset_expired?</span>
  <span class="n">reset_sent_at</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span>
<span class="k">end</span>
</pre></div></div>
<p>As noted in <a href="https://www.railstutorial.org/book/password_reset#sec-resetting_the_password" class="hyperref">Section&nbsp;<span class="ref">12.3</span></a>, if we read <code>&lt;</code> as earlier than instead of less than, this code makes sense as the English sentence The password reset was sent earlier than two hours ago.</p>
</div><div id="cha-12_footnotes">
  <div class="footnotes">
    <div id="_cha-12_footnote-1" class="footnote"><a class="footnote-link" href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-ref-1">1.</a> This chapter is independent of the others apart from using the mailer generation in <a href="https://www.railstutorial.org/book/account_activation#code-generate_user_mailer" class="hyperref">Listing&nbsp;<span class="ref">11.6</span></a>, but it closely parallels <a href="https://www.railstutorial.org/book/account_activation#cha-account_activation" class="hyperref">Chapter&nbsp;<span class="ref">11</span></a>, so its much easier if youve followed that chapter first.</div>
    <div id="_cha-12_footnote-2" class="footnote"><a class="footnote-link" href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-ref-2">2.</a> Security concerns about revealing the absence of the given email address are common misplaced.<span class="intersentencespace"></span> The reason is that this property is already present in every website that wont let you sign up with an email address thats already in use, which is practically all of them.<span class="intersentencespace"></span> Thus, indicating that a given email address isnt available for password resets gives potential attackers no additional information.</div>
    <div id="_cha-12_footnote-3" class="footnote"><a class="footnote-link" href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-ref-3">3.</a> We need only handle the case where the password is empty because if the confirmation is empty, the confirmation validation (which is skipped if the password is empty) will catch the problem and supply a relevant error message.</div>
    <div id="_cha-12_footnote-4" class="footnote"><a class="footnote-link" href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-ref-4">4.</a> Alert reader Khaled Teilab has noted that one advantage of using <code>errors.add(:password, :blank)</code> is that the resulting message is automatically rendered in the correct language when using the <code class="tt">rails-i18n</code> gem.</div>
    <div id="_cha-12_footnote-5" class="footnote"><a class="footnote-link" href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-ref-5">5.</a> Thanks to reader Tristan Ludowyk for suggesting this feature and for providing both a detailed description and a suggested implementation.</div>
    <div id="_cha-12_footnote-6" class="footnote"><a class="footnote-link" href="https://www.railstutorial.org/book/password_reset#cha-12_footnote-ref-6">6.</a> This proof is the price you pay for reading a web development tutorial written by a Ph.D. physicist.<span class="intersentencespace"></span> Just be grateful I couldnt find a way to work <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;msup&gt;&lt;mi class=&quot;MJX-variant&quot;&gt;&amp;#x210F;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;&amp;#x03C8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;&amp;#x03C8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-181" style="width: 11.308em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.19em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.887em, 1010.19em, 4.066em, -999.997em); top: -3.236em; left: 0em;"><span class="mrow" id="MathJax-Span-182"><span class="mrow" id="MathJax-Span-183"><span class="mo" id="MathJax-Span-184" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">(</span></span><span class="mrow" id="MathJax-Span-185"><span class="mo" id="MathJax-Span-186" style="font-family: MathJax_Main;"></span><span class="mfrac" id="MathJax-Span-187"><span style="display: inline-block; position: relative; width: 1.122em; height: 0px; margin-right: 0.121em; margin-left: 0.121em;"><span style="position: absolute; clip: rect(3.183em, 1000.77em, 4.184em, -999.997em); top: -4.413em; left: 50%; margin-left: -0.35em;"><span class="msubsup" id="MathJax-Span-188"><span style="display: inline-block; position: relative; width: 0.768em; height: 0px;"><span style="position: absolute; clip: rect(3.359em, 1000.41em, 4.184em, -999.997em); top: -4.001em; left: 0em;"><span class="mi" id="MathJax-Span-189" style="font-size: 70.7%; font-family: MathJax_Main;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.295em; left: 0.474em;"><span class="mn" id="MathJax-Span-190" style="font-size: 50%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(3.359em, 1000.95em, 4.184em, -999.997em); top: -3.589em; left: 50%; margin-left: -0.468em;"><span class="mrow" id="MathJax-Span-191"><span class="mn" id="MathJax-Span-192" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-193" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; clip: rect(0.827em, 1001.12em, 1.239em, -999.997em); top: -1.292em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.122em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.063em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-194"><span style="display: inline-block; position: relative; width: 1.239em; height: 0px;"><span style="position: absolute; clip: rect(3.124em, 1000.77em, 4.242em, -999.997em); top: -4.001em; left: 0em;"><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Main;"></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.354em; left: 0.827em;"><span class="mn" id="MathJax-Span-196" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-197" style="font-family: MathJax_Main; padding-left: 0.238em;">+</span><span class="mi" id="MathJax-Span-198" style="font-family: MathJax_Math-italic; padding-left: 0.238em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.18em;"></span></span></span><span class="mo" id="MathJax-Span-199" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">)</span></span></span><span class="mi" id="MathJax-Span-200" style="font-family: MathJax_Math-italic; padding-left: 0.18em;"></span><span class="mo" id="MathJax-Span-201" style="font-family: MathJax_Main; padding-left: 0.297em;">=</span><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Math-italic; padding-left: 0.297em;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math-italic;"></span></span><span style="display: inline-block; width: 0px; height: 3.241em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.781em; border-left: 0px solid; width: 0px; height: 2.16em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>(</mo><mrow><mo></mo><mfrac><msup><mi class="MJX-variant"></mi><mn>2</mn></msup><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><msup><mi mathvariant="normal"></mi><mn>2</mn></msup><mo>+</mo><mi>V</mi></mrow><mo>)</mo></mrow><mi></mi><mo>=</mo><mi>E</mi><mi></mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> \left(-\frac{\hbar^2}{2m}\nabla^2 + V\right)\psi = E\psi </script></span> or <span class="inline_math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mi&gt;&amp;#x03BD;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;8&lt;/mn&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mi&gt;&amp;#x03BD;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mi&gt;&amp;#x03BD;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-204" style="width: 11.367em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.248em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.298em, 1010.13em, 2.653em, -999.997em); top: -2.235em; left: 0em;"><span class="mrow" id="MathJax-Span-205"><span class="msubsup" id="MathJax-Span-206"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(3.124em, 1000.77em, 4.184em, -999.997em); top: -4.001em; left: 0em;"><span class="mi" id="MathJax-Span-207" style="font-family: MathJax_Math-italic;">G</span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.354em; left: 0.768em;"><span class="texatom" id="MathJax-Span-208"><span class="mrow" id="MathJax-Span-209"><span class="mi" id="MathJax-Span-210" style="font-size: 70.7%; font-family: MathJax_Math-italic;"></span><span class="mi" id="MathJax-Span-211" style="font-size: 70.7%; font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main; padding-left: 0.297em;">=</span><span class="mn" id="MathJax-Span-213" style="font-family: MathJax_Main; padding-left: 0.297em;">8</span><span class="mi" id="MathJax-Span-214" style="font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-215"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(3.183em, 1000.71em, 4.184em, -999.997em); top: -4.001em; left: 0em;"><span class="mi" id="MathJax-Span-216" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.121em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.354em; left: 0.768em;"><span class="texatom" id="MathJax-Span-217"><span class="mrow" id="MathJax-Span-218"><span class="mi" id="MathJax-Span-219" style="font-size: 70.7%; font-family: MathJax_Math-italic;"></span><span class="mi" id="MathJax-Span-220" style="font-size: 70.7%; font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-221" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-222" style="font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-223" style="font-family: MathJax_Main; padding-left: 0.297em;">4</span><span class="mi" id="MathJax-Span-224" style="font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.062em;"></span></span><span class="msubsup" id="MathJax-Span-225"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(3.183em, 1000.71em, 4.184em, -999.997em); top: -4.001em; left: 0em;"><span class="mi" id="MathJax-Span-226" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.121em;"></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span><span style="position: absolute; top: -4.354em; left: 0.768em;"><span class="texatom" id="MathJax-Span-227"><span class="mrow" id="MathJax-Span-228"><span class="mi" id="MathJax-Span-229" style="font-size: 70.7%; font-family: MathJax_Math-italic;"></span><span class="mi" id="MathJax-Span-230" style="font-size: 70.7%; font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.007em;"></span></span></span></span><span class="mo" id="MathJax-Span-231" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.24em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.324em; border-left: 0px solid; width: 0px; height: 1.245em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><mi></mi><mi></mi></mrow></msup><mo>=</mo><mn>8</mn><mi></mi><msup><mi>T</mi><mrow class="MJX-TeXAtom-ORD"><mi></mi><mi></mi></mrow></msup><mo stretchy="false">(</mo><mo>=</mo><mn>4</mn><mi></mi><msup><mi>T</mi><mrow class="MJX-TeXAtom-ORD"><mi></mi><mi></mi></mrow></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-14"> G^{\mu\nu} = 8\pi T^{\mu\nu} (=4\tau T^{\mu\nu}) </script></span> into the exposition.</div>
  </div>
</div></div></div>
<div class="book-bottom-menu">
<div class="bookMenu-arrows">
<a class="leftArrow" href="javascript://"></a>
<a class="upArrow" href="javascript://"></a>
<a class="rightArrow" href="javascript://"></a>
</div>
</div>
</div>
<div id="bookContentNotAvailable">
<img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/empty_content-bfd29214ec2dceaedc8664ee5d1379fb01c94658fb95ac9edde6d31d3d0e7484.png" alt="Empty content bfd29214ec2dceaedc8664ee5d1379fb01c94658fb95ac9edde6d31d3d0e7484">
Sorry, content not available
</div>
</div>
<div class="emailPitch" id="bookEmailModal">
<a onclick="closeEmailPops()" class="emailSignupClose" href="javascript://">x</a>
<strong>GET A FREE EMAIL COURSE ON WEB DEVELOPMENT</strong>
<p>Sign up now to get a free 8-part email course on learning web development. This will also ensure you get updates about the Ruby on Rails Tutorial and related products (such as the <a href="http://learnenough.com/">Learn Enough to Be Dangerous</a> series of tutorials).</p>

<div class="j_followBookForm"><div id="j_bookFollowForm">
<form action="https://www.softcover.io/books/216/follow" accept-charset="UTF-8" data-remote="true" method="get"><input name="utf8" type="hidden" value="">
<!-- %input{name: "name", type: "text", placeholder: "YOUR NAME"} -->
<input name="email" placeholder="Your email address" type="text">
<input class="greyButton optClick_follow" data-disable-with="Submitting..." type="submit" value="Follow Author">
</form>

<p id="j_bookFollowNotice" style="display:none"></p>
</div>
</div>
</div>
<script>
  // setup book nav
  $(function(){
    Book.init({
      title: "Ruby on Rails Tutorial (Rails 5)",
      path: "/book",
      slug: "ruby_on_rails_tutorial_4th_edition",
      isArticle: false,
      s3_path_prefix: "636/ruby_on_rails_tutorial_4th_edition",
      chapters: [{"title":"Frontmatter","number":0,"slug":"frontmatter","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/frontmatter_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033344Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=cdceed8ea017654ef50f3aaaacc9716aa90b2988eb020900596e005f4bbccd35"},{"title":"Chapter 1: From zero to deploy","number":1,"slug":"beginning","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/beginning_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033344Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c75373ce36712336a4166bb5581011ad7ccf1dd3e588139c0b09ee5e99d1d965"},{"title":"Chapter 2: A toy app","number":2,"slug":"toy_app","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/toy_app_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033344Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4c93b14092b85c922f6b341d5292a0f68f446fa32aec0e8c7c818be132d1361f"},{"title":"Chapter 3: Mostly static pages","number":3,"slug":"static_pages","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/static_pages_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033344Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=fa837f1af59dd4f991ae40e24b285644124845da7a24e76280c3424b42e62316"},{"title":"Chapter 4: Rails-flavored Ruby","number":4,"slug":"rails_flavored_ruby","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/rails_flavored_ruby_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033344Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=acb91f0575a568d83b1967afff1e2bd93b44bd79344f8f34fb77fa86b3e3f370"},{"title":"Chapter 5: Filling in the layout","number":5,"slug":"filling_in_the_layout","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/filling_in_the_layout_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033344Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a7a134b6315aa9591dc01ca5e568f52b9c39d2288f06fcb9b45c6ee647006ae5"},{"title":"Chapter 6: Modeling users","number":6,"slug":"modeling_users","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/modeling_users_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=84b0ab96d62919e0129bd885dd50c90a97602fa56e40197d89fa85eb3bdf285a"},{"title":"Chapter 7: Sign up","number":7,"slug":"sign_up","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/sign_up_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=528e9ccafa5bccfb1971c9af9ea31a4f9b5189f7f8a7a612ded0356530e1e6e1"},{"title":"Chapter 8: Basic login","number":8,"slug":"basic_login","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/basic_login_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=deb3ffac3d36a36969db45fef6b828768d6d6e5dd3fad35fcbd4fec5a508805b"},{"title":"Chapter 9: Advanced login","number":9,"slug":"advanced_login","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/advanced_login_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ea212efe0c8b6e1417f38809050fdea40e9cbc3df381fd2c40745ed931a33800"},{"title":"Chapter 10: Updating, showing, and deleting users","number":10,"slug":"updating_and_deleting_users","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/updating_and_deleting_users_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=a41159d6e229e0706b2d258e8f0165458700d31d3c90ec07756f0b5f3a900d18"},{"title":"Chapter 11: Account activation","number":11,"slug":"account_activation","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/account_activation_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=4680e3e1fac6429fea6cab3a03ac7bc18c1df5eea079d7a586bd6ac25e524257"},{"title":"Chapter 12: Password reset","number":12,"slug":"password_reset","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/password_reset_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=3d3fa6be44329dbdef6f20c67837bb358f85664adc583a7b689964cd7145a31a"},{"title":"Chapter 13: User microposts","number":13,"slug":"user_microposts","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/user_microposts_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033345Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=23a9257fa4ddada71a6e756959803df5215708d5167898e60a5c2a59eae2e773"},{"title":"Chapter 14: Following users","number":14,"slug":"following_users","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/html/following_users_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20181027T033346Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20181027/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2da6ebce9efdfb2b7e9858385d51e285a6b908c3b413c66cf86a2396b56f460d"}],
      full_page: false,
      custom_math: "\"failing\": \"\\\\coloredtext{red}{\\\\textsc{\\\\textbf{red}}}\",\n\"passing\": \"\\\\coloredtext{ForestGreen}{\\\\textsc{\\\\textbf{green}}}\",\n\"rt\": \"\\\\emph{Rails Tutorial}\",\n\"letbd\": \"\\\\href{http://learnenough.com/story}{Learn Enough to Be Dangerous}\",\n\"lesite\": \"\\\\href{http://learnenough.com/}{Learn Enough}\",\n\"lecl\": \"\\\\href{http://learnenough.com/command-line-tutorial}{\\\\emph{Learn Enough Command Line to Be Dangerous}}\",\n\"leg\": \"\\\\href{http://learnenough.com/git-tutorial}{\\\\emph{Learn Enough Git to Be Dangerous}}\",\n\"leh\": \"\\\\href{http://learnenough.com/html-tutorial}{\\\\emph{Learn Enough HTML to Be Dangerous}}\",\n\"ler\": \"\\\\href{http://learnenough.com/ruby-tutorial}{\\\\emph{Learn Enough Ruby to Be Dangerous}}\",\n\"lete\": \"\\\\href{http://learnenough.com/text-editor-tutorial}{\\\\emph{Learn Enough Text Editor to Be Dangerous}}\",\n\"rort\": \"\\\\href{http://railstutorial.org/}{Ruby on Rails Tutorial}\",\n\"rortb\": \"\\\\href{http://railstutorial.org/book}{\\\\emph{Ruby on Rails Tutorial}}\",\n\"lev\": \"\\\\href{http://learnenough.com/vim-tutorial}{\\\\emph{Learn Enough Vim to Be Dangerous}}\",\n\"les\": \"\\\\href{http://learnenough.com/sinatra-tutorial}{\\\\emph{Learn Enough Sinatra to Be Dangerous}}\",\n\"lera\": \"\\\\href{http://learnenough.com/ruby-on-rails-tutorial}{\\\\emph{Learn Enough Rails to Be Dangerous}}\",\n\"lecss\": \"\\\\href{http://www.learnenough.com/css-and-layout-tutorial}{\\\\emph{Learn Enough CSS \\\\& Layout to Be Dangerous}}\",\n\"ledev\": \"\\\\href{https://learnenough.com/dev-environment-tutorial}{\\\\emph{Learn Enough Dev Environment to Be Dangerous}}\",\n\"ccby\": \"\\\\href{https://creativecommons.org/licenses/by/2.0/}{Creative Commons Attribution 2.0 Generic}\",\n\"ccbysa\": \"\\\\href{https://creativecommons.org/licenses/by-sa/2.0/}{Creative Commons Attribution-ShareAlike 2.0 Generic}\",\n\"ccbync\": \"\\\\href{https://creativecommons.org/licenses/by-nc/2.0/}{Creative Commons Attribution-NonCommercial 2.0 Generic}\",\n\"ccbynd\": \"\\\\href{https://creativecommons.org/licenses/by-nd/2.0/}{Creative Commons Attribution-NoDerivs 2.0 Generic}\",\n\"xkcduse\": \"Copyright  Randall Munroe and used unaltered under the terms of the \\\\href{https://creativecommons.org/licenses/by-nc/2.5/}{Creative Commons Attribution-NonCommercial 2.5 Generic} license.\",\n\"gemfilenote\": \"\\\\textbf{Important note: For all the Gemfiles in this book, you should use the version numbers listed at \\\\href{http://gemfiles-4th-ed.railstutorial.org/}{gemfiles-4th-ed.rails\\\\-tutorial.org} instead of the ones listed below (although they should be identical if you are reading this online).}\",\n\"secondgemfilenote\": \"As always, you should use the version numbers listed at \\\\href{http://gemfiles-4th-ed.railstutorial.org/}{gemfiles-4th-ed.rails\\\\-tutorial.org} instead of the ones listed here.\""
    });
    Book.scrolling();
  });
</script>

<div class="footer clearfix">
<div class="wrapper" id="hide_chromeFooter">
<em>powered by</em>
<a class="logo" href="http://www.softcover.io/"><img src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/logo_foot-2bb1fc62a4fe7cfdd8223560afd5fea72ad2696d7a3886cfe471ef18a80a1fb4.png" alt="Logo foot 2bb1fc62a4fe7cfdd8223560afd5fea72ad2696d7a3886cfe471ef18a80a1fb4">
</a></div>
</div>

</div>
</div>
<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
    // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
    // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/54eea5d20a23b37d87000040.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>

<script type="text/javascript">
setTimeout(function(){var a=document.createElement("script");
var b=document.getElementsByTagName("script")[0];
a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0023/6713.js?"+Math.floor(new Date().getTime()/3600000);
a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>



<div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./Chapter 12_ Password reset _ Ruby on Rails Tutorial (Rails 5) _ Softcover.io_files/__Bz3h5RzMx.html" style="border: none;"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size2, sans-serif;"></div></div><div id="gtx-trans" style="position: absolute; left: 994px; top: 30161.8px;"><div class="gtx-trans-icon"></div></div></body></html>